[{"data":{"search":{"issueCount":26,"edges":[{"node":{"number":4503,"title":"Bug Report: CLI Fails with Mismatched Function Call/Response Error","url":"https://github.com/google-gemini/gemini-cli/issues/4503","state":"OPEN","createdAt":"2025-07-19T17:49:44Z","body":"### What happened?\n\n\n  Bug Report: CLI Fails with Mismatched Function Call/Response Error\n\n  Title:\n  CLI Bug: INVALID_ARGUMENT due to mismatched function call and response parts.\n\n\n  Description:\n  The Gemini CLI client is frequently and consistently failing with a 400 INVALID_ARGUMENT error. The error message indicates a\n  core logic issue where the number of function responses being sent by the client does not match the number of function calls\n  requested by the model.\n\n\n  This is not tied to a specific user command or tool, but appears to be a fundamental bug in how the CLI handles the tool-use\n  communication loop with the Gemini API. The issue renders the CLI client unreliable and largely unusable.\n\n  Error Message:\n\n\n   1 {\n   2   \"error\": {\n   3     \"code\": 400,\n   4     \"message\": \"Please ensure that the number of function response parts is equal to the number of function call parts \n     of the function call turn.\",\n   5     \"status\": \"INVALID_ARGUMENT\"\n   6   }\n   7 }\n\n\n  To Reproduce:\n  The error occurs during general interaction with the CLI. Any user prompt that leads the model to attempt a tool call can\n  trigger this bug. The failure is in the client-side logic, not in the user's specific input.\n\n\n  Expected Behavior:\n  The CLI client should correctly format and send one response part for every function call part requested by the model, allowing\n  the conversation to proceed without error.\n\n\n  Environment:\n   * Tool: Gemini CLI\n   * Model: (Not model-specific, but observed with Gemini Pro)\n   * Impact: Critical. The CLI is not reliably functional.\n\n\n╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮\n│ >   Type your message or @path/to/file                                                                                          │\n╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯\n\n~                                    no sandbox (see /docs)                                       gemini-2.5-pro (99% context left)\n\n\n\n\n### What did you expect to happen?\n\nno API Error:\n\n### Client information\n\n<details>\n\n```console\n$ gemini /about\n# paste output here\n```\n\n</details>\n\n\n### Login information\n\n_No response_\n\n### Anything else we need to know?\n\n_No response_","comments":{"totalCount":1,"nodes":[{"body":"maybe correlated with session time or general load (I get knocked back to -flash eventually), but its not obviously so.\n\nOnce it happens, it doesnt heal, istm exit is only answer.","author":{"login":"jimc"}}]}}},{"node":{"number":4356,"title":"BadRequest error occurs when gemini cli reads dts file.","url":"https://github.com/google-gemini/gemini-cli/issues/4356","state":"OPEN","createdAt":"2025-07-17T07:15:29Z","body":"### What happened?\n\n```\n ╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮\n │ ✔  ReadFile fdt-system-top.dts                                                                                                                                  │\n │                                                                                                                                                                 │\n │    Read audio file: fdt-system-top.dts                                                                                                                          │\n ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"Request contains an invalid argument.\",\n      \"errors\": [\n        {\n          \"message\": \"Request contains an invalid argument.\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]]\n```\n\n### What did you expect to happen?\n\nBadRequest error occurs when gemini cli reads dts file.\n\n### Client information\n\n<details>\n\n```console\n$ gemini /about\n# paste output here\n```\n\n</details>\n\n\n### Login information\n\n_No response_\n\n### Anything else we need to know?\n\n_No response_","comments":{"totalCount":0,"nodes":[]}}},{"node":{"number":4520,"title":"request contains invalid argument v0.1.13","url":"https://github.com/google-gemini/gemini-cli/issues/4520","state":"OPEN","createdAt":"2025-07-19T22:58:21Z","body":"### What happened?\n\njust updated to 0.1.13 and on simple prompts i'm getting:\n\n```json\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"Request contains an invalid argument.\",\n      \"errors\": [\n        {\n          \"message\": \"Request contains an invalid argument.\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]]\n```\n\n\n### What did you expect to happen?\n\nanswer the prompt\n\n### Client information\n\n\n* **CLI Version:** 0.1.13\n* **Git Commit:** 412b78c5 (local modifications)\n* **Operating System:** linux v22.17.1\n* **Sandbox Environment:** no sandbox\n* **Model Version:** gemini-2.5-flash\n* **Memory Usage:** 169.6 MB\n\n\n### Login information\n\ngoogle account\n\n### Anything else we need to know?\n\n_No response_","comments":{"totalCount":6,"nodes":[{"body":"got same error after upgrade to 0.1.13","author":{"login":"kyeongwookma"}},{"body":"got same error after upgrade to 0.1.13","author":{"login":"alfaz151"}},{"body":"> got same error after upgrade to 0.1.13\n\nyes, i also","author":{"login":"rubickecho"}},{"body":"Got stuck on it right now, but indeed, after adding some MCP servers (yet unused in this session). Chaning `/auth`  does not help neither logging out and in. Ref: \n```\n\n╭───────────────────────────────╮\n│  > check your neo4j services  │\n╰───────────────────────────────╯\n\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"Request contains an invalid argument.\",\n      \"errors\": [\n        {\n          \"message\": \"Request contains an invalid argument.\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]]\n\n\n╭───────────╮\n│  > /auth  │\n╰───────────╯\n\n\n╭───────────────────────────────╮\n│  > check your neo4j services  │\n╰───────────────────────────────╯\n\n✕ [API Error: {\"error\":{\"message\":\"{\\n  \\\"error\\\": {\\n    \\\"code\\\": 400,\\n    \\\"message\\\": \\\"schema at properties.node can only contain properties starting with '$' when $ref is present\\\",\\n  \n    \\\"status\\\": \\\"INVALID_ARGUMENT\\\"\\n  }\\n}\\n\",\"code\":400,\"status\":\"Bad Request\"}}]\n\n\n╭──────────╮\n│  > ping  │\n╰──────────╯\n\n✕ [API Error: {\"error\":{\"message\":\"{\\n  \\\"error\\\": {\\n    \\\"code\\\": 400,\\n    \\\"message\\\": \\\"schema at $defs.Node.properties.key_property can only contain properties starting with '$' when \n  $ref is present\\\",\\n    \\\"status\\\": \\\"INVALID_ARGUMENT\\\"\\n  }\\n}\\n\",\"code\":400,\"status\":\"Bad Request\"}}]\n\n\n╭──────────╮\n│  > /mcp  │\n╰──────────╯\n\n\nℹ Configured MCP servers:\n... \n```","author":{"login":"Manamama"}},{"body":"same issues on same install","author":{"login":"hpiera-muteskin"}},{"body":"I have tried pinpointing the presumably wrong MCP server via the \"divide and conquer\" method; I have thus left the 4 barebone ones that I need the most. Results: no error.  While doing so, I have been saving the chat with Gemini about this bug and then we both (sic) have been tinkering with A/B testing. And when I was about to triumphally declare to Gemini \"I have found the MCPs, they are  somewhere in the other set!\", then ... the `settings.json` containing by now the very same 4 barebone ones (that used to work just a minute before) resulted in the same error, out of the blue, when the session was restored.  \n\nNotes: changing API keys via `/auth` does not help; `/clear` does not help. \n\n\nI have read the related https://github.com/google-gemini/gemini-cli/issues/3764, https://github.com/google-gemini/gemini-cli/issues/2141 (some from 3 weeks ago) and they suggest the chat history corruption instead of MPC settings being messed up, after all.\n\nAt any rate, I have spent 2 hours on it and am none the wiser, despite being a competent Gemini CLI user by now, so this cryptic error needs at least an \"upgrade\" so that then end users shall know which backend or middleware (MCPs still?) or maybe the front-end itself (Gemini CLI's code?) is to blame...  \n","author":{"login":"Manamama"}}]}}},{"node":{"number":1690,"title":"INVALID_ARGUMENT resuming a saved chat (400 BadRequest)","url":"https://github.com/google-gemini/gemini-cli/issues/1690","state":"OPEN","createdAt":"2025-06-26T01:19:03Z","body":"### What happened?\n\nAfter `/chat save`, `/quit`, `gemini`, `/chat load` the conversation history is showing up but the response to all prompts is:\n\n```\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"Please ensure that the number of function response parts is equal to the number of function call parts of the function call turn.\",\n      \"errors\": [\n        {\n          \"message\": \"Please ensure that the number of function response parts is equal to the number of function call parts of the function call turn.\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]]\n\n\n> What do we do with error messages like above?\n\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"Please ensure that the number of function response parts is equal to the number of function call parts of the function call turn.\",\n      \"errors\": [\n        {\n          \"message\": \"Please ensure that the number of function response parts is equal to the number of function call parts of the function call turn.\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]]\n```\n\nThe `settings.json` file is pretty vanilla\n```\n{\n  \"theme\": \"Dracula\",\n  \"selectedAuthType\": \"oauth-personal\",\n  \"preferredEditor\": \"cursor\"\n}\n```\n\n### What did you expect to happen?\n\nResume my chat with the entire history in the context as if I never interrupted it.\n\n### Client information\n\n<details>\n\n```console\n$ gemini -v\n0.1.3\n```\n\n</details>\n\n\n### Login information\n\n_No response_\n\n### Anything else we need to know?\n\n_No response_","comments":{"totalCount":22,"nodes":[{"body":"same problem for me - looks like a bug","author":{"login":"DarrenJCoxon"}},{"body":"Im stuck at this exact point","author":{"login":"dudufcb1"}},{"body":"Same, it's very annoying. My workaround was to open a new chat in cursor with gemini 2.5 pro, then do this:\n\n1. Ask it to look through this link to find where conversations are stored: https://github.com/google-gemini/gemini-cli/tree/main\n2.  Ask it to find the conversation that crashed and copy the it into a non-hidden folder\n3. Start a new conversation in gemini-cli and @ the file so it can read the last conversation.","author":{"login":"kayazuko"}},{"body":"I can take a stab at this.\n\n**Initial Analysis**\n\n **The Problem**\n\n  When loading a saved chat that contained function calls and responses:\n  1. The code was displaying function call/response items in the UI, even though they have no\n  displayable text\n  2. This created a mismatch in the chat history where the Gemini API expected function calls\n  and responses to be properly paired\n\n  **The Solution**\n\n  Modified /packages/cli/src/ui/hooks/slashCommandProcessor.ts to:\n  1. Continue adding all items to the chat history (to maintain API compatibility)\n  2. Only display items that contain text content and aren't function calls/responses\n  3. Add a check hasOnlyText to identify items that contain only text parts\n  4. Skip displaying items with function calls or responses while keeping them in the history","author":{"login":"heartyguy"}},{"body":"Same issue here. Guess I won't be experimenting with your software this weekend.","author":{"login":"dhstrom"}},{"body":"same","author":{"login":"somersby10ml"}},{"body":"same problem here","author":{"login":"SalmanKarkhano"}},{"body":"I am also getting same error\n","author":{"login":"MFaiqKhan"}},{"body":"for me this happens when it wants to take two actions, but if I want to interrupt and stop it from executing them. To do that I have to hit escape twice. And when I do that every subsequent follow up via question or slash command has this number of function response mismatch problem. ","author":{"login":"bubosanac"}},{"body":"I've gone back to Claude Code. Feels like it was released too early. Like Firebase Studio.","author":{"login":"DarrenJCoxon"}}]}}},{"node":{"number":3773,"title":"API Error","url":"https://github.com/google-gemini/gemini-cli/issues/3773","state":"OPEN","createdAt":"2025-07-10T11:42:16Z","body":"### What happened?\n\n [API Error: {\"error\":{\"message\":\"{\\n  \\\"error\\\": {\\n    \\\"code\\\": 400,\\n    \\\"message\\\": \\\"* \n  GenerateContentRequest.tools[0].function_declarations[11].parameters.properties[url].format: only 'enum' and 'date-time' are supported for STRING type\\\\n\\\",\\n    \\\"status\\\": \n  \\\"INVALID_ARGUMENT\\\"\\n  }\\n}\\n\",\"code\":400,\"status\":\"Bad Request\"}}]\n\n\n### What did you expect to happen?\n\nProper Answer\n\n### Client information\n\n\n*   **CLI Version:** 0.1.9\n*   **Git Commit:** 34935d6\n*   **Operating System:** win32 v22.17.0\n*   **Sandbox Environment:** no sandbox\n*   **Model Version:** gemini-2.5-pro\n*   **Memory Usage:** 146.0 MB\n\n\n### Login information\n\nAPI\n\n### Anything else we need to know?\n\n_No response_","comments":{"totalCount":0,"nodes":[]}}},{"node":{"number":4504,"title":"api error:  INVALID_ARGUMENT","url":"https://github.com/google-gemini/gemini-cli/issues/4504","state":"OPEN","createdAt":"2025-07-19T18:13:29Z","body":"### What happened?\n\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"Please ensure that the number of function response parts is equal to the number of function call \n  parts of the function call turn.\",\n      \"errors\": [\n        {\n          \"message\": \"Please ensure that the number of function response parts is equal to the number of function call \n  parts of the function call turn.\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]]\n\n\n\n### What did you expect to happen?\n\nworked.\n\n### Client information\n\n\n* **CLI Version:** 0.1.12\n* **Git Commit:** N/A\n* **Operating System:** darwin v24.3.0\n* **Sandbox Environment:** no sandbox\n* **Model Version:** gemini-2.5-flash\n* **Memory Usage:** 158.7 MB\n\n\n### Login information\n\n_No response_\n\n### Anything else we need to know?\n\n_No response_","comments":{"totalCount":1,"nodes":[{"body":"Could you please provide more context? Did you use the /compress command? If so, this might be a duplicate of #3709 ","author":{"login":"skeshive"}}]}}},{"node":{"number":1477,"title":"How to use claude model through vertexai","url":"https://github.com/google-gemini/gemini-cli/issues/1477","state":"OPEN","createdAt":"2025-06-25T15:39:35Z","body":"Although Vertex AI can use the Claude models, when I set the environment variable `GEMINI_MODEL` to `claude-sonnet-4@20250514` and ran the gemini CLI, I got the following error:\n```\n✕ [API Error: countTokens is infeasible for projects/{PROJECT_ID}/locations/us-east5/publishers/google/models/claude-sonnet-4@20250514 (Status: INVALID_ARGUMENT)]\n```\nIt seems this happens because the model’s publisher is listed as `google` rather than `anthropic`.\nIs there any way to change the publisher in the gemini-cli? \nAlso, are Claude models intentionally blocked?","comments":{"totalCount":4,"nodes":[{"body":"We're using [the GenAI library ](https://github.com/googleapis/js-genai) for access vertex so we have all it's limitations. I can say that excluding Claude wasn't intentional on our part (though I'll be honest, I didn't realize you could use it through Vertex).","author":{"login":"scidomino"}},{"body":"@scidomino maybe LiteLLM could be an option to circumvent some of these limitations at least for a number of LLMs providers out there.","author":{"login":"loretoparisi"}},{"body":"I haven't gotten around to VertexAI yet but I have direct anthropic support and openai here: \n\nhttps://github.com/acoliver/llxprt-code\n\nany openai compatible \"should work\" \n\nThis is a fork I'm keeping roughly up to date with head. In addition it supports the OpenAI responses model. I've tested with local, open router, Fireworks and groq. \n\nJust set the openai provider, a baseurl and keyfile or key. You should be able to use most anything. BTW you can also go directly to openai or anthropic. ","author":{"login":"acoliver"}},{"body":"We haven't actually gotten this to work, but at least from looking at the code, this should work:\n```\ngemini --model=publishers/anthropic/models/claude-3-5-haiku\n```\n\n(We just enabled the model, so it's possible we just need to wait a bit longer.)","author":{"login":"jsoref"}}]}}},{"node":{"number":4557,"title":"Errors with full context.","url":"https://github.com/google-gemini/gemini-cli/issues/4557","state":"OPEN","createdAt":"2025-07-20T17:27:25Z","body":"### What happened?\n\nIMPORTANT: This conversation approached the input token limit for gemini-2.5-pro. A compressed context will be sent for \n  future messages (compressed from: 746551 to 747012 tokens).\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"Please ensure that the number of function response parts is equal to the number of function call parts of \n  the function call turn.\",\n      \"errors\": [\n        {\n          \"message\": \"Please ensure that the number of function response parts is equal to the number of function call parts \n  of the function call turn.\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]]\n\n### What did you expect to happen?\n\nFor the app to fix its context or even allow me to compress it.\n\n### Client information\n\n\n* **CLI Version:** 0.1.13\n* **Git Commit:** 412b78c5 (local modifications)\n* **Operating System:** linux v22.12.0\n* **Sandbox Environment:** no sandbox\n* **Model Version:** gemini-2.5-pro\n* **Memory Usage:** 229.6 MB\n\n\n### Login information\n\n_No response_\n\n### Anything else we need to know?\n\n_No response_","comments":{"totalCount":0,"nodes":[]}}},{"node":{"number":3401,"title":"GenerateContentRequest.tools[0].function_declarations[15].parameters.properties[time].enum[0]: cannot be empty","url":"https://github.com/google-gemini/gemini-cli/issues/3401","state":"OPEN","createdAt":"2025-07-06T16:28:40Z","body":"\n## Describe the bug\nWhen putting mcp servers in the settings.json file I get\n✕ [API Error: {\"error\":{\"message\":\"{\\n  \\\"error\\\": {\\n    \\\"code\\\": 400,\\n    \\\"message\\\": \\\"* \n  GenerateContentRequest.tools[0].function_declarations[17].parameters.properties[time].enum[0]: cannot be empty\\\\n\\\",\\n    \n  \\\"status\\\": \\\"INVALID_ARGUMENT\\\"\\n  }\\n}\\n\",\"code\":400,\"status\":\"Bad Request\"}}]\n\nWhen I have a mcp server, all requests are broke.\n\nsettings file\n{\n  \"mcpServers\": {\n    \"reddit\": {\n      \"command\": \"uv\",\n      \"args\": [\n        \"--directory=/Users/andrew/saga/saaga/mcp/social/mcp-server-reddit\",\n        \"run\",\n        \"mcp-server-reddit\"\n      ]\n    }\n  }\n}\n\n## Additional context\nIf I remove the mcp servers it works. I suspect it has something to do with a parameter type of a function.\n\n\n## Diagnostic Information\n*   **CLI Version:** 0.1.3\n*   **Git Commit:** 382486e (local modifications)\n*   **Operating System:** darwin v18.16.0\n*   **Sandbox Environment:** no sandbox\n*   **Model Version:** gemini-2.5-flash\n*   **Memory Usage:** 177.3 MB\n","comments":{"totalCount":3,"nodes":[{"body":"Duplicate of #2978 ","author":{"login":"AlipSnowMan"}},{"body":"> [!NOTE]\n>  ","author":{"login":"AlipSnowMan"}},{"body":"Possible duplicate of https://github.com/google-gemini/gemini-cli/issues/2926","author":{"login":"jackwotherspoon"}}]}}},{"node":{"number":3709,"title":"Failed to compress chat history","url":"https://github.com/google-gemini/gemini-cli/issues/3709","state":"OPEN","createdAt":"2025-07-09T22:51:47Z","body":"### What happened?\n\nFailed to compress chat history: Please ensure that the number of  function response parts is equal to the number of function call  parts of the function call turn.\n[API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"Please ensure that the number of function response \n  parts is equal to the number of function call parts of the function \n  call turn.\",\n      \"errors\": [\n        {\n          \"message\": \"Please ensure that the number of function \n  response parts is equal to the number of function call parts of the \n  function call turn.\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]]\n\n### What did you expect to happen?\n\n /compress \ncompress chat history\n\n### Client information\n\n\n*   **CLI Version:** 0.1.9\n*   **Git Commit:** 34935d6\n*   **Operating System:** win32 v22.17.0\n*   **Sandbox Environment:** no sandbox\n*   **Model Version:** gemini-2.5-pro\n*   **Memory Usage:** 158.2 MB\n\n\n### Login information\n\n_No response_\n\n### Anything else we need to know?\n\n_No response_","comments":{"totalCount":1,"nodes":[{"body":"The code above is pretty badly formatted, here it is with extra context from my duplicate #4568 \n\n```\nℹ IMPORTANT: This conversation approached the input token limit for gemini-2.5-flash. A compressed context will be sent for future messages (compressed from: 741653 to 90649 tokens).\n\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"Please ensure that the number of function response parts is equal to the number of function call parts of the function call turn.\",\n      \"errors\": [\n        {\n          \"message\": \"Please ensure that the number of function response parts is equal to the number of function call parts of the function call turn.\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]]\n\n\n╭───────────────────────────────╮\n│  > coll but let's keep going  │\n╰───────────────────────────────╯\n\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"Please ensure that the number of function response parts is equal to the number of function call parts of the function call turn.\",\n      \"errors\": [\n        {\n          \"message\": \"Please ensure that the number of function response parts is equal to the number of function call parts of the function call turn.\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]]\n\n\n╭─────────────────╮\n│  > ok let's go  │\n╰─────────────────╯\n\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"Please ensure that the number of function response parts is equal to the number of function call parts of the function call turn.\",\n      \"errors\": [\n        {\n          \"message\": \"Please ensure that the number of function response parts is equal to the number of function call parts of the function call turn.\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]]\n\n✕ Failed to compress chat history: Please ensure that the number of function response parts is equal to the number of function call parts of the function call turn.\n```","author":{"login":"corneliusroemer"}}]}}},{"node":{"number":1619,"title":"The input token count _ exceeds the maximum number of tokens allowed (1048576).\"","url":"https://github.com/google-gemini/gemini-cli/issues/1619","state":"OPEN","createdAt":"2025-06-25T21:12:26Z","body":"**Describe the bug**\nWhen I execute a prompt, e.g. when planning to migrate something, a huge number of files are sent to the API, but the API gets angry: \"The input token count (5276502) exceeds the maximum number of tokens allowed (1048576).\"\n\n**Full error:**\n```\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"The input token count (5276502) exceeds the maximum number of tokens allowed (1048576).\",\n      \"errors\": [\n        {\n          \"message\": \"The input token count (5276502) exceeds the maximum number of tokens allowed (1048576).\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]]\n```\n\n**Client information**\nCLI Version: 0.1.3                                                                  \nGit Commit: 382486e (local modifications)                                         \nModel: gemini-2.5-pro                                                         \nSandbox: no sandbox                                                             \nOS: darwin\n\n**Login information**\nGoogle Account oauth idk\n\n**Additional context**\nIt could be my mistake for mentioning a folder, but there should be a smarter way to handle this. 👀\n","comments":{"totalCount":8,"nodes":[{"body":"Same issue","author":{"login":"disdi"}},{"body":"Same issue. The CLI should at least give better feedback about what was the input context. ","author":{"login":"twardoch"}},{"body":"API key\nAbout Gemini CLI                                                                                                       │\n│                                                                                                                        │\n│ CLI Version                              0.1.3                                                                         │\n│ Git Commit                               382486e (local modifications)                                                 │\n│ Model                                    gemini-2.5-pro                                                                │\n│ Sandbox                                  no sandbox                                                                    │\n│ OS                                       linux             \n\n```\n✕ [API Error: The input token count (1078728) exceeds the maximum number of tokens allowed (1048576). (Status: INVALID_ARGUMENT)]\n\n\n> /chat\n\n✕ Unknown /chat command: undefined. Available: list, save, resume\n\n\n> /compress\n\n✕ Failed to compress chat history: {\"error\":{\"code\":400,\"message\":\"The input token count (1078728) exceeds the maximum number of tokens allowed (1048576).\",\"status\":\"INVALID_ARGUMENT\"}}\n\n```","author":{"login":"torronen"}},{"body":"Same, always get : \"✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"The input token count (3678201) exceeds the maximum number of tokens\n  allowed (1048576).\",\n      \"errors\": [\n        {\n          \"message\": \"The input token count (3678201) exceeds the maximum number of tokens\n  allowed (1048576).\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]]\"","author":{"login":"Macflylegamer"}},{"body":"WAIT I think I found a temporary fix, I just told the AI to look at my project (for me it was \"C:\\Users\\Admin\\Downloads\\AnimePlayer-master\") WITHOUT using \"@\" and it worked!\n\nThe only thing I did is telle Gemini \"Can you _ my project is in _\"","author":{"login":"Macflylegamer"}},{"body":"I started getting this issue today. Before it would process a project with over 10M tokens with no problems. When it reached the 1M limit it would start forgetting things but this error didn't occur.\n\nBtw i forgot to mention that i update it once a day before using it, at 5am UTC. ","author":{"login":"AldebaraanMKII"}},{"body":"After updating today at the usual time i no longer get this error.","author":{"login":"AldebaraanMKII"}},{"body":"Got this bug while searching text in a large codebase(LibreOffice).\n\nIMHO gemini-cli should detect that the input token count is invalid and try to reduce the token count without affecting the quality of the inference too much.","author":{"login":"brlin-tw"}}]}}},{"node":{"number":3764,"title":"API Error","url":"https://github.com/google-gemini/gemini-cli/issues/3764","state":"OPEN","createdAt":"2025-07-10T10:17:48Z","body":"### What happened?\n\nafter a long chat session of fixing testing suite code,  Gemini CLI returned this error, and any further inputs yields the same error.  how should I continue without losing context?    There is still 52% context left.\n\nℹ IMPORTANT: This conversation approached the input token limit for gemini-2.5-flash. A compressed\n  context will be sent for future messages (compressed from: 736101 to 193587 tokens).\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"Please ensure that the number of function response parts is equal to the number\n  of function call parts of the function call turn.\",\n      \"errors\": [\n        {\n          \"message\": \"Please ensure that the number of function response parts is equal to the\n  number of function call parts of the function call turn.\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]]\n\n\n### What did you expect to happen?\n\nno error\n\n### Client information\n\n\n*   **CLI Version:** 0.1.10\n*   **Git Commit:** da50a1ee (local modifications)\n*   **Operating System:** win32 v22.16.0\n*   **Sandbox Environment:** no sandbox\n*   **Model Version:** gemini-2.5-flash\n*   **Memory Usage:** 302.8 MB\n\n\n### Login information\n\n_No response_\n\n### Anything else we need to know?\n\n_No response_","comments":{"totalCount":5,"nodes":[{"body":"Hey it looks there is something malformed function response in the chat history, we need to find it and remove it.\n\nDo you mind you run ``/chat save error-details`` to a checkpoint file and send us the checkpoint-error-details.json file? It should be in a folder inside ~/.gemini/tmp/.","author":{"login":"SandyTao520"}},{"body":"i can't find /.gemini/tmp/ - where is it?  i'm running windows","author":{"login":"CapyDojo"}},{"body":"here is a manual copy and paste of the chat context:\n\nUsing 1 GEMINI.md file\n╭────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮\n│ >   Type your message or @path/to/file                                                                                 │\n╰────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯\n\nC:\\temp\\rdln-project (feature/sprint-1-ocr-refactor*)      no sandbox (see /docs)       gemini-2.5-pro (100% context left)\n\n ███            █████████  ██████████ ██████   ██████ █████ ██████   █████ █████\n░░░███         ███░░░░░███░░███░░░░░█░░██████ ██████ ░░███ ░░██████ ░░███ ░░███\n  ░░░███      ███     ░░░  ░███  █ ░  ░███░█████░███  ░███  ░███░███ ░███  ░███\n    ░░░███   ░███          ░██████    ░███░░███ ░███  ░███  ░███░░███░███  ░███\n     ███░    ░███    █████ ░███░░█    ░███ ░░░  ░███  ░███  ░███ ░░██████  ░███\n   ███░      ░░███  ░░███  ░███ ░   █ ░███      ░███  ░███  ░███  ░░█████  ░███\n ███░         ░░█████████  ██████████ █████     █████ █████ █████  ░░█████ █████\n░░░            ░░░░░░░░░  ░░░░░░░░░░ ░░░░░     ░░░░░ ░░░░░ ░░░░░    ░░░░░ ░░░░░\n\n\nTips for getting started:\n1. Ask questions, edit files, or run commands.\n2. Be specific for the best results.\n3. /help for more information.\n\n\n╭─────────────────────────────────────────────────────────────────────────────────────────────────────────╮\n│  > check @src\\components\\RedlineOutput.tsx for syntax errors                                            │\n│    --- Content from referenced files ---No files matching the criteria were found or all were skipped.  │\n│    --- End of content ---                                                                               │\n╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯\n\n✦ I've identified several syntax errors in C:\\temp\\rdln-project\\src\\components\\RedlineOutput.tsx. Specifically, there's a\n  duplicated function definition for findAndCombineSubstitution and some stray code blocks that are causing issues. I will now\n  correct these errors.\n✦ I have removed the duplicate function definition. I will now re-read the file to ensure there are no other syntax errors.\n✦ It appears that the previous fix has resolved all syntax errors in the file. The code is now syntactically correct.\n\n╭───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮\n│  > @src\\components\\RedlineOutput.tsx - we need to work out why findandcombinesubstitution isn't grouping this sample          │\n│    optimally:  <div class=\"chunk-container\" style=\"\"><span>This ISDA Master Agreement (Multicurrency-Cross Border)            │\n│    (\"Agreement\") is entered into between </span><span class=\"bg-theme-accent-100 text-theme-accent-800 border                 │\n│    border-theme-accent-300 line-through decoration-2 decoration-theme-accent-600\">Goldman</span><span                         │\n│    class=\"bg-theme-secondary-100 text-theme-secondary-800 border border-theme-secondary-300 underline decoration-2            │\n│    decoration-theme-secondary-600\">J.P.</span><span> </span><span class=\"bg-theme-accent-100 text-theme-accent-800 border     │\n│    border-theme-accent-300 line-through decoration-2 decoration-theme-accent-600\">Sachs</span><span                           │\n│    class=\"bg-theme-secondary-100 text-theme-secondary-800 border border-theme-secondary-300 underline decoration-2            │\n│    decoration-theme-secondary-600\">Morgan</span><span> </span><span class=\"bg-theme-accent-100 text-theme-accent-800 border   │\n│    border-theme-accent-300 line-through decoration-2 decoration-theme-accent-600\">International</span><span                   │\n│    class=\"bg-theme-secondary-100 text-theme-secondary-800 border border-theme-secondary-300 underline decoration-2            │\n│    decoration-theme-secondary-600\">Securities plc</span><span>,</span><span> </span><span>a</span><span>                      │\n│    </span><span>company</span><span> </span><span>incorporated</span><span> </span><span>in</span><span>                      │\n│    </span><span>England</span><span> </span><span>and</span><span> </span><span>Wales</span><span                             │\n│    class=\"bg-theme-secondary-100 text-theme-secondary-800 border border-theme-secondary-300 underline decoration-2            │\n│    decoration-theme-secondary-600\"> </span></div>                                                                             │\n│    --- Content from referenced files ---No files matching the criteria were found or all were skipped.                        │\n│    --- End of content ---                                                                                                     │\n╰───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯       \n\n✦ Based on the provided HTML output, it seems the findAndCombineSubstitution function isn't grouping the \"Goldman Sachs\n  International\" -> \"J.P. Morgan Securities plc\" change as a single, cohesive substitution. Instead of one large change, it's\n  being broken down into several smaller ones.\n\n  This is happening because the function stops looking for more parts of a substitution as soon as it finds a matching pair of\n  \"removed\" and \"added\" changes. It needs to be more greedy and continue scanning to see if the substitution continues.\n\n  I will now modify the findAndCombineSubstitution function to correctly group these changes by allowing it to scan further\n  ahead for related changes.\n\n╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────╮\n│  > pls explain in lay terms what you are proposing.  how greedy? i'm worried it will break other functions  │\n╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯\n\n✦ Of course. Here is a simplified explanation of the proposed change.\n\n  The Problem (Current Behavior):\n\n  Imagine you're editing the sentence \"The quick brown fox jumps.\" to \"The fast red cat leaps.\"\n\n  The current code is like an editor who makes one-word changes at a time. It sees:\n   1. quick -> fast (Okay, that's a change, I'm done with this spot.)\n   2. brown -> red (Okay, another change, done.)\n   3. fox -> cat (And another.)\n\n  It treats them as three separate, unrelated edits. In the code example you provided, it sees Goldman -> J.P., stops, and\n  treats it as a finished change, then moves on to Sachs -> Morgan as a separate change.\n\n  The Proposed Solution (The \"Greedy\" Approach):\n\n  The new logic tells the editor to be a bit smarter and \"greedier.\" Instead of stopping after the first word, it will look\n  ahead to see if the next words are also part of the same substitution.\n\n  It will now see:\n   1. quick -> fast... (Wait, let me peek ahead...)\n   2. The next word is brown -> red... (This looks like it's part of the same change, let me grab it too...)\n   3. The next word is fox -> cat... (Still part of it, I'll take it.)\n   4. The next word is jumps -> leaps. (Okay, this whole phrase seems to be one single change.)\n\n  The result is that it correctly groups \"The quick brown fox jumps\" into \"The fast red cat leaps\" as a single, logical edit.\n\n  How it Addresses Your Concern:\n\n  You're right to be cautious about it being too greedy. Here’s how we prevent it from breaking other things:\n\n   1. It's Not Infinitely Greedy: The \"greediness\" is limited by a pre-existing configuration setting\n      (MAX_SUBSTITUTION_SCAN_LENGTH). It will only look ahead a reasonable number of characters before it stops. It won't try to        \n      group changes from opposite ends of the document.\n   2. It Only Groups Direct Substitutions: This logic only applies when a removed word/phrase is immediately followed by an added       \n       word/phrase (or separated by simple whitespace). It won't incorrectly group an added section from one paragraph with a\n      removed section from another.\n   3. It Doesn't Change Other Logic: This change is isolated to the findAndCombineSubstitution function. It doesn't affect how\n      simple additions or deletions are handled elsewhere.\n\n  In short, the change makes the function smarter about identifying multi-word substitutions, leading to a cleaner and more\n  accurate output, without introducing risks to other parts of the system.\n\n  Shall I proceed with this change?\n\n╭───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮\n│  > will it still respect, e.g., natural sentence boundaries?  i.e. semantic full stops periods (but not abbreviations /   │\n│    initials periods)                                                                                                      │\n╰───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯\n\n✦ That's an excellent and subtle question. The short answer is: no, the change I'm proposing will not break natural sentence \n  boundaries because the logic for substitution grouping and the logic for semantic chunking are separate.\n\n  Let me break it down:\n\n   1. Substitution Grouping (`findAndCombineSubstitution`): This function's only job is to look for a pattern of removed text\n      immediately followed by added text (allowing for whitespace in between). It's what turns removed(\"Goldman\") +\n      added(\"J.P.\") into a single logical change.\n       * It does not analyze the content. It doesn't know what a period is. It only sees the type of change.\n       * The \"greedy\" change I'm proposing simply allows it to continue looking for more removed/added pairs in the immediate\n         vicinity, so it can group Goldman Sachs -> J.P. Morgan correctly. It will stop as soon as it hits a block of unchanged\n         text that isn't just whitespace.\n\n   2. Semantic Chunking (`findSemanticChunkBoundary`): This is a completely separate function that runs at a different stage.\n      Its job is to look at the stream of changes and decide where to split the content into large, efficient chunks for\n      display.\n       * This is the function that understands sentence boundaries. It explicitly looks for periods, commas, and newlines (., ,,        \n         \\n) to find natural breaking points.\n       * This function is what prevents a single display chunk from ending awkwardly in the middle of a sentence.\n\n  In summary:\n\n  Think of it as a two-step process:\n\n   1. First, we run the \"greedy\" substitution grouper to clean up the raw diff, correctly identifying multi-word changes.\n   2. Second, we feed that cleaned-up result into the semantic chunker, which then intelligently breaks the content into large\n      display blocks based on sentence boundaries.\n\n  The change to the first step makes its output better for the second step, but it doesn't change the rules the second step\n  uses. The two systems work together but have distinct responsibilities.\n\n  Therefore, the proposed change is safe. It will improve the grouping of substitutions without affecting how sentence\n  boundaries are respected.\n\n  Shall I proceed?\n\n╭───────────────────╮\n│  > great, pls do  │\n╰───────────────────╯\n\n✦ Excellent. I will now apply the change to the findAndCombineSubstitution function in\n  C:\\temp\\rdln-project\\src\\components\\RedlineOutput.tsx.\n✦ The change has been applied successfully. The findAndCombineSubstitution function will now correctly group related\n  substitutions, providing a much cleaner and more accurate redline output.\n\n  Is there anything else I can help you with?\n\n╭────────────────────────────────────────────────────╮\n│  > error: \"C:\\temp\\rdln-project\\Debug_Logs\\B.txt\"  │\n╰────────────────────────────────────────────────────╯\n\n✦ It seems you've pointed me to an error log. I will now read the contents of C:\\temp\\rdln-project\\Debug_Logs\\B.txt to\n  understand the error.\n✦ I see the problem. The error log points to an \"Unterminated string constant\" at line 389 of\n  C:\\temp\\rdln-project\\src\\components\\RedlineOutput.tsx.\n\n  This happened because when I last replaced the code, I accidentally included the ''' markers (which are used to define\n  multi-line strings for the tool) inside the file's content. This created invalid TypeScript code.\n\n  I will now correct this by removing the erroneous markers from the file.\n✦ I've removed the incorrect starting markers. Now I'll remove the closing markers to fully resolve the issue.\n✦ I have removed the erroneous string markers from the RedlineOutput.tsx file. The syntax error should now be resolved. Please\n  check if the error is gone.\n\n╭────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮\n│  > <div class=\"chunk-container\" style=\"\"><span>This ISDA Master Agreement (Multicurrency-Cross Border) (\"Agreement\") is    │\n│    entered into</span><span class=\"bg-theme-accent-100 text-theme-accent-800 border border-theme-accent-300 line-through   │\n│    decoration-2 decoration-theme-accent-600\"> </span><span>between</span><span> </span><span class=\"bg-theme-accent-100    │\n│    text-theme-accent-800 border border-theme-accent-300 line-through decoration-2                                          │\n│    decoration-theme-accent-600\">Goldman</span><span class=\"bg-theme-secondary-100 text-theme-secondary-800 border          │\n│    border-theme-secondary-300 underline decoration-2 decoration-theme-secondary-600\">J.P.</span><span> </span><span        │\n│    class=\"bg-theme-accent-100 text-theme-accent-800 border border-theme-accent-300 line-through decoration-2               │\n│    decoration-theme-accent-600\">Sachs</span><span class=\"bg-theme-secondary-100 text-theme-secondary-800 border            │\n│    border-theme-secondary-300 underline decoration-2 decoration-theme-secondary-600\">Morgan</span><span> </span><span      │\n│    class=\"bg-theme-accent-100 text-theme-accent-800 border border-theme-accent-300 line-through decoration-2               │\n│    decoration-theme-accent-600\">International</span><span class=\"bg-theme-secondary-100 text-theme-secondary-800 border    │\n│    border-theme-secondary-300 underline decoration-2 decoration-theme-secondary-600\">Securities                            │\n│    plc</span><span>,</span><span> </span><span>a</span><span> </span><span>company</span><span>                            │\n│    </span><span>incorporated</span><span> </span><span>in</span><span> </span><span>England</span><span                    │\n╰────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯\n\n✦ It appears the previous fix was not sufficient, and the substitution is still being broken up. The issue likely lies in how\n  the function handles unchanged whitespace between the removed and added parts of the substitution.\n\n  I will re-examine the findAndCombineSubstitution function to identify the flaw in the logic and implement a more robust\n  solution. First, I will read the file to get its current content.\n✦ I've analyzed the issue again, and I've pinpointed the flaw in the findAndCombineSubstitution function's logic. My previous\n  fix made it \"greedy,\" but it was still too simplistic and failed to correctly identify the boundaries of a complex\n  substitution like the \"Goldman Sachs\" example.\n\n  I have devised a more robust, two-pass approach:\n\n   1. Identify Sequence: First, the function will scan ahead to find the longest possible sequence of added, removed, and\n      whitespace changes.\n   2. Validate and Combine: Once it has this sequence, it will check if it contains both additions and removals. If it does, it\n      will then combine them into a single, logical substitution.\n\n  This new logic is more precise and correctly handles cases where multiple, adjacent words are changed, while still correctly\n  ignoring unrelated changes.\n\n  I will now replace the old function with this improved version.\n✦ I have implemented the new, more robust findAndCombineSubstitution function. This should finally resolve the incorrect\n  grouping of complex substitutions. Please verify the output now.\n\n╭───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮       \n│  > i think it got worse?!   <div class=\"chunk-container\" style=\"\"><span>This ISDA Master Agreement (Multicurrency-Cross       │       \n│    Border) (\"Agreement\") is entered into between </span><span class=\"bg-theme-accent-100 text-theme-accent-800 border         │       \n│    border-theme-accent-300 line-through decoration-2 decoration-theme-accent-600\">Goldman</span><span                         │       \n│    class=\"bg-theme-secondary-100 text-theme-secondary-800 border border-theme-secondary-300 underline decoration-2            │       \n│    decoration-theme-secondary-600\">J.P.</span><span> </span><span class=\"bg-theme-accent-100 text-theme-accent-800 border     │       \n│    border-theme-accent-300 line-through decoration-2 decoration-theme-accent-600\">Sachs</span><span                           │       \n│    class=\"bg-theme-secondary-100 text-theme-secondary-800 border border-theme-secondary-300 underline decoration-2            │       \n│    decoration-theme-secondary-600\">Morgan</span><span> </span><span class=\"bg-theme-accent-100 text-theme-accent-800 border   │       \n│    border-theme-accent-300 line-through decoration-2 decoration-theme-accent-600\">International</span><span                   │       \n│    class=\"bg-theme-secondary-100 text-theme-secondary-800 border border-theme-secondary-300 underline decoration-2            │       \n│    decoration-theme-secondary-600\">Securities plc</span><span>,</span><span> </span><span>a</span><span>                      │       \n│    </span><span>company</span><span> </span><span>incorporated</span><span> </span><span>in</span><span>                      │       \n│    </span><span>England</span><span> </span><span>and</span><span> </span><span>Wales</span><span                             │       \n│    class=\"bg-theme-secondary-100 text-theme-secondary-800 border border-theme-secondary-300 underline decoration-2            │       \n│    decoration-theme-secondary-600\"> </span></div>                                                                             │       \n╰───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯       \n\n✦ You are right to be frustrated. My previous attempts have failed to correct the issue, and I apologize for that. The problem\n  is more subtle than I initially realized, and my fixes have not been precise enough.\n\n  The core of the issue lies in how the findAndCombineSubstitution function decides when a substitution ends. It's being too\n  eager to declare a substitution complete, especially when it encounters unchanged whitespace between the removed and added\n  parts.\n\n  I have created a new version of the function with a more careful, step-by-step approach. Here's how it works:\n\n   1. It will start at the beginning of a potential change.\n   2. It will scan forward, change by change, and collect all removed parts into one string and all added parts into another.\n   3. Crucially, if it finds unchanged whitespace after a substitution has started, it will correctly include it in both the\n      removed and added strings to maintain spacing.\n   4. It will only stop when it hits a piece of unchanged text that is an actual word, or another type of change that clearly\n      marks the end of the substitution.\n   5. Finally, if and only if it has found both removed and added text in this sequence, it will combine them into a single,\n      logical change.\n\n  This method is more direct and less prone to the errors of my previous attempts. It should correctly group the \"Goldman Sachs\n  International\" -> \"J.P. Morgan Securities plc\" change as a single unit.\n\n  I am confident that this new approach will solve the problem. May I proceed with implementing it?\n\n╭──────────────────────────────────────────────────────────────────────────╮\n│  > is this still confined to findAndCombineSubstitution and do no harm?  │\n╰──────────────────────────────────────────────────────────────────────────╯\n\n✦ Yes, absolutely.\n\n   1. Confined to `findAndCombineSubstitution`: The change is 100% contained within the findAndCombineSubstitution function. No\n      other function, component, or file will be modified. The inputs it receives and the output it produces follow the exact\n      same structure as before, so its \"contract\" with the rest of the code is unchanged.\n\n   2. Do No Harm: This is the most important principle, and the new logic is designed specifically to honor it.\n       * It fixes the specific bug: It correctly groups the complex \"Goldman Sachs...\" substitution.\n       * It preserves what works: It will still correctly handle simple, single-word substitutions. A removed followed by an\n         added is the simplest case, and the new logic handles that perfectly.\n       * It has clear boundaries: The logic will stop immediately when it encounters any \"real\" unchanged text (anything other\n         than whitespace). This prevents it from incorrectly merging unrelated changes that happen to be near each other.\n\n  In essence, the proposed change is a surgical fix. It replaces a flawed implementation with a more robust one inside the exact        \n   same function, making it more precise without altering its role or affecting its neighbors.\n\n╭─────────────────────────────────────╮\n│  > ok, proceed with the draft diff  │\n╰─────────────────────────────────────╯\n\n✦ I will now proceed. First, I will read the file to ensure I have the precise text to replace.\n✦ Understood. I will now replace the flawed findAndCombineSubstitution function with the new, more precise version.\n✦ I have implemented the new findAndCombineSubstitution function. I am confident this will resolve the issue. Please verify the\n  output.\n\n╭────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮      \n│  > nope: <div class=\"chunk-container\" style=\"\"><span>This ISDA Master Agreement (Multicurrency-Cross Border) (\"Agreement\") is │       \n│     entered into between </span><span class=\"bg-theme-accent-100 text-theme-accent-800 border border-theme-accent-300         │       \n│    line-through decoration-2 decoration-theme-accent-600\">Goldman</span><span class=\"bg-theme-secondary-100                   │       \n│    text-theme-secondary-800 border border-theme-secondary-300 underline decoration-2                                          │       \n│    decoration-theme-secondary-600\">J.P.</span><span> </span><span class=\"bg-theme-accent-100 text-theme-accent-800 border     │       \n│    border-theme-accent-300 line-through decoration-2 decoration-theme-accent-600\">Sachs</span><span                           │       \n│    class=\"bg-theme-secondary-100 text-theme-secondary-800 border border-theme-secondary-300 underline decoration-2            │       \n│    decoration-theme-secondary-600\">Morgan</span><span> </span><span class=\"bg-theme-accent-100 text-theme-accent-800 border   │       \n│    border-theme-accent-300 line-through decoration-2 decoration-theme-accent-600\">International</span><span                   │       \n│    class=\"bg-theme-secondary-100 text-theme-secondary-800 border border-theme-secondary-300 underline decoration-2            │       \n│    decoration-theme-secondary-600\">Securities plc</span><span>,</span><span> </span><span>a</span><span>                      │       \n│    </span><span>company</span><span> </span><span>incorporated</span><span> </span><span>in</span><span>                      │       \n│    </span><span>England</span><span> </span><span>and</span><span> </span><span>Wales</span><span                             │       \n│    class=\"bg-theme-secondary-100 text-theme-secondary-800 border border-theme-secondary-300 underline decoration-2            │       \n│    decoration-theme-secondary-600\"> </span></div>                                                                             │       \n╰────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯      \n\n✦ I sincerely apologize. You are correct to be frustrated, and I am very sorry that my previous attempts have not only failed to        \n   fix the issue but have made it seem worse. I have clearly underestimated the complexity of this problem, and my repeated\n  failures are unacceptable.\n\n  I have taken a step back to conduct a much deeper analysis of why my fixes have failed.\n\n  The Root Cause of My Failures:\n\n  My previous approaches were fundamentally flawed because they were too simplistic. They were designed to find a simple Removed        \n   -> Added pattern and would stop as soon as they found the first match. They were incapable of understanding a more complex\n  sequence like Removed -> Added -> Whitespace -> Removed -> Added.... This is why the \"Goldman Sachs\" change was constantly\n  being fragmented.\n\n  A New, Correct, and Final Approach:\n\n  I have developed a new, much more robust algorithm that works in three distinct, careful steps. This is not just a small\n  tweak; it is a complete redesign of the logic inside the findAndCombineSubstitution function.\n\n   1. Scan and Group: First, the function will scan forward from a starting point and gather every adjacent added, removed, and\n      whitespace unchanged block into a single, temporary group. It will only stop when it hits \"real\" text that has not been\n      changed.\n   2. Validate: Next, it will examine this group to ensure it's a legitimate substitution. It does this by asking two simple\n      questions: \"Does this group contain at least one removed block?\" and \"Does it contain at least one added block?\"\n   3. Combine: Only if the answer to both questions is \"yes\" will it proceed. It will then intelligently combine all the pieces\n      into a single, clean \"changed\" object, preserving the correct spacing.\n\n  This approach is fundamentally different because it gathers all the context first before making a decision. It will correctly\n  see the entire \"Goldman Sachs International\" -> \"J.P. Morgan Securities plc\" sequence as a single potential group, validate\n  it, and combine it properly.\n\n  This change remains 100% confined to the findAndCombineSubstitution function and will not harm any other part of the\n  application.\n\n  I am confident this is the correct solution. I humbly ask for one more chance to implement this fix. May I proceed?\n\n╭────────╮\n│  > ok  │\n╰────────╯\n\n✦ Thank you. I will proceed with the utmost care.\n\n  First, I will read the file to ensure I have the exact text to replace.\n✦ I will now replace the flawed function with the new, correct implementation.\n✦ I have replaced the function with the new, correct logic. I am confident that this will finally resolve the issue. Please\n  verify the output.\n\n╭───────────────────────────────────────────────────╮\n│  > still no change. dont code any further. debug  │\n╰───────────────────────────────────────────────────╯\n\n✦ You are absolutely right to stop me. I am deeply sorry. My repeated failures are unacceptable, and I understand your\n  frustration. I will not write another line of code to fix this until we have a precise understanding of the problem.\n\n  I will now begin a debugging process. My goal is to see the exact data and logic flow that is causing this failure.\n\n  Here is my plan:\n\n   1. Instrument the Code: I need to add temporary console.log statements to the generateSemanticHTMLString function. This will\n      allow me to see two critical things in the browser's developer console:\n       * The exact changes array that is being processed.\n       * What the findAndCombineSubstitution function is returning at every step of the loop.\n   2. Analyze the Output: With this information, I can trace the execution step-by-step and pinpoint exactly where the logic is\n      failing. I will be looking for the flaw in how the sequence is being grouped, validated, or combined.\n\n  This is a diagnostic step only. I will not attempt a fix. I will only add the logging code and then analyze the output.\n\n  May I proceed with adding the temporary console.log statements for debugging?\n\n╭─────────╮\n│  > yes  │\n╰─────────╯\n\n✦ Understood. I will now add the debugging statements to the generateSemanticHTMLString function in\n  C:\\temp\\rdln-project\\src\\components\\RedlineOutput.tsx.\n\n  First, I will read the file to get the most current content.\n✦ I will now insert the console.log statements into the generateSemanticHTMLString function.\n✦ The debugging code has been added. Please run the application and check the browser's developer console. The console should\n  now contain detailed logs of the changes array and the step-by-step execution of the findAndCombineSubstitution function.\n\n  Please paste the console output here so I can analyze it.\n\n╭───────────────────────────────────────────────╮\n│  > dispatchEventsForPlugins @ chunk-ZFBEYDM4  │\n╰───────────────────────────────────────────────╯\n\n✦ That line seems to be from the browser's internal event system, not the specific debug logs I added.\n\n  Could you please re-run the comparison and check the browser's developer console again? The output I'm looking for should\n  start with:\n\n  --- DEBUG: Changes Array ---\n\n  It will be followed by a series of logs for each step of the process, starting with:\n\n  --- DEBUG: Iteration 0 ---\n\n  Please make sure you are looking at the \"Console\" tab in the developer tools and copy the full output related to this\n  debugging. This will give me the data I need to finally solve this.\n\n╭──────────────────────────────────────────────────────────────────────────────────────────────────╮\n│  > useComparison.ts:249  System protection disabled - allowing unrestricted processing for stre  │\n╰──────────────────────────────────────────────────────────────────────────────────────────────────╯\n\n✦ I see that log message, but it seems to be a general system message and not the specific debug output I was hoping to see. The        \n  debug logs I added will be clearly marked with --- DEBUG: in the browser's developer console.\n\n  It's very likely that the component is failing to render because of a syntax error I introduced in a previous step and failed\n  to clean up. I apologize for this oversight. I see that the file still contains the ''' markers from a previous tool call,\n  which is causing the code to crash before my debug logs can ever run.\n\n  I will now remove those erroneous markers. This is a necessary cleanup step before we can proceed with debugging.\n\n  First, I will read the file to get the exact content.\n\n╭───────────────────╮\n│  > callCallback2  │\n╰───────────────────╯\n\n✦ I'm sorry, I don't understand what \"callCallback2\" means in this context. Could you please clarify what you would like me to\n  do?\n\n  Are you providing output from the console, or is this a new instruction?\n\n╭───────────────────────╮\n│  > processDispatchQu  │\n╰───────────────────────╯\n\n✦ I'm sorry, I don't understand \"processDispatchQu\". Could you please clarify what you would like me to do?\n✦ I see the problem. The ''' markers are still present at the end of the findAndCombineSubstitution function, causing a syntax\n  error that prevents the component from rendering and thus the debug logs from appearing. I apologize for this oversight.\n\n  I will now remove these erroneous markers. This is a critical cleanup step to allow the application to run and for us to get\n  the necessary debug output.\n\n╭─────────────────────────────────────────────────────────────────────────╮\n│  > processDispatchQueueItemsInOrder @ chunk-ZFBEYDM4.js?v=bdf5722b:703  │\n╰─────────────────────────────────────────────────────────────────────────╯\n\n✦ The output you provided (processDispatchQueueItemsInOrder @ chunk-ZFBEYDM4.js?v=bdf5722b:703) seems to be an internal browser\n  or framework message, not the detailed debugging logs I added.\n\n  To get the necessary debugging information, please:\n\n   1. Open your browser's developer console. (Usually by pressing F12 or right-clicking on the page and selecting \"Inspect\" or\n      \"Inspect Element\", then navigating to the \"Console\" tab).\n   2. Refresh the application page.\n   3. Look for messages starting with \"--- DEBUG:\" in the console. These are the logs from the RedlineOutput.tsx component.\n\n  Please copy and paste the full output from the console, especially any lines starting with \"--- DEBUG:\". This will show me the        \n  changes array and the step-by-step results of findAndCombineSubstitution.\n\n╭────────────────────────────────────────────────╮\n│  > useComparison.ts:249  System protection di  │\n╰────────────────────────────────────────────────╯\n\n✦ It seems like you've encountered a new message: \"useComparison.ts:249 System protection di\". This is not the debug output I\n  was expecting from RedlineOutput.tsx.\n\n  This message appears to be a separate issue, possibly a system-level warning or error. To debug the original problem with\n  findAndCombineSubstitution, I still need the console.log output from the browser's developer console (usually accessible by\n  pressing F12 in your browser) after running the application.\n\n  Please provide the full output from the console, specifically looking for the logs I added in generateSemanticHTMLString (they        \n  start with \"--- DEBUG:\").\n\n╭──────────────────────────────────────────────────────────────────────────────────────────────────╮\n│  > useComparison.ts:249  System protection disabled - allowing unrestricted processing for stre  │\n╰──────────────────────────────────────────────────────────────────────────────────────────────────╯\n\n✦ That's an interesting log from useComparison.ts, but it's not the debugging output I'm looking for.\n\n  I need the output from the console.log statements I added to src/components/RedlineOutput.tsx. This output will appear in your        \n  browser's developer console (usually accessed by pressing F12 or right-clicking and selecting \"Inspect\" or \"Inspect Element\").        \n\n  Please open your browser's developer console, refresh the page where the redline output is displayed, and then copy and paste\n  all the --- DEBUG: lines from the console here.\n\n╭────────────────────────────────────────────────╮\n│  > useComparison.ts:249  System protection di  │\n╰────────────────────────────────────────────────╯\n\n✦ It seems like you've encountered a new message: \"useComparison.ts:249 System protection di\". This is not the debug output I\n  was expecting from RedlineOutput.tsx.\n\n  This message appears to be a separate issue, possibly a system-level warning or error. To debug the original problem with\n  findAndCombineSubstitution, I still need the console.log output from the browser's developer console (usually accessible by\n  pressing F12 in your browser) after running the application.\n\n  Please provide the full output from the console, specifically looking for the logs I added in generateSemanticHTMLString (they        \n  start with \"--- DEBUG:\").\n\n╭──────────────────────────────────────────────────────────────────────────────────────────────────╮\n│  > useComparison.ts:249  System protection disabled - allowing unrestricted processing for stre  │\n╰──────────────────────────────────────────────────────────────────────────────────────────────────╯\n\n✦ That's an interesting log from useComparison.ts, but it's not the debugging output I'm looking for.\n\n  I need the output from the console.log statements I added to src/components/RedlineOutput.tsx. This output will appear in your        \n  browser's developer console (usually accessed by pressing F12 or right-clicking and selecting \"Inspect\" or \"Inspect Element\").        \n\n  Please open your browser's developer console, refresh the page where the redline output is displayed, and then copy and paste\n  all the --- DEBUG: lines from the console here.\n\n╭────────────────────────────────────╮\n│  > (anonymous) @ chunk-ZFBEYDM4.j  │\n╰────────────────────────────────────╯\n\n✦ The output (anonymous) @ chunk-ZFBEYDM4.j is not the detailed debug log I was expecting. It looks like a truncated or partial\n  error message from a minified JavaScript file.\n\n  To properly debug this, I need the full output from the browser's developer console, specifically looking for the logs that\n  start with:\n\n   * --- DEBUG: Changes Array ---\n   * --- DEBUG: Iteration X ---\n\n  Could you please ensure the developer console is open when you run the application and then copy and paste the entire console\n  output related to these debug messages?\n\n╭──────────────────────────────────────────────────────────────────────────────────────────────────╮\n│  > useComparison.ts:249  System protection disabled - allowing unrestricted processing for stre  │\n╰──────────────────────────────────────────────────────────────────────────────────────────────────╯\n\n✦ That's an interesting log from useComparison.ts, but it's not the debugging output I'm looking for.\n\n  I need the output from the console.log statements I added to src/components/RedlineOutput.tsx. This output will appear in your        \n  browser's developer console (usually accessed by pressing F12 or right-clicking and selecting \"Inspect\" or \"Inspect Element\").        \n\n  Please open your browser's developer console, refresh the page where the redline output is displayed, and then copy and paste\n  all the --- DEBUG: lines from the console here.\n\n╭────────────────────────────────────╮\n│  > (anonymous) @ chunk-ZFBEYDM4.j  │\n╰────────────────────────────────────╯\n\n✦ The output (anonymous) @ chunk-ZFBEYDM4.j is not the detailed debug log I was expecting. It looks like a truncated or partial\n  error message from a minified JavaScript file.\n\n  To properly debug this, I need the full output from the browser's developer console, specifically looking for the logs that\n  start with:\n\n   * --- DEBUG: Changes Array ---\n   * --- DEBUG: Iteration X ---\n\n  Could you please ensure the developer console is open when you run the application and then copy and paste the entire console\n  output related to these debug messages?\n\n╭────────────────────────────────────╮\n│  > (anonymous) @ chunk-ZFBEYDM4.j  │\n╰────────────────────────────────────╯\n\n✦ The output (anonymous) @ chunk-ZFBEYDM4.j is not the detailed debug log I was expecting. It looks like a truncated or partial\n  error message from a minified JavaScript file.\n\n  To properly debug this, I need the full output from the browser's developer console, specifically looking for the logs that\n  start with:\n\n   * --- DEBUG: Changes Array ---\n   * --- DEBUG: Iteration X ---\n\n  Could you please ensure the developer console is open when you run the application and then copy and paste the entire console\n  output related to these debug messages?\n\n\n\n\n\n\n╭────────╮\n│  > hi  │\n╰────────╯\n\n\nℹ ⚡ You have reached your daily gemini-2.5-pro quota limit.\n  ⚡ Automatically switching from gemini-2.5-pro to gemini-2.5-flash for the remainder of this session.\n  ⚡ To increase your limits, upgrade to a Gemini Code Assist Standard or Enterprise plan with higher limits at \n  https://goo.gle/set-up-gemini-code-assist\n  ⚡ Or you can utilize a Gemini API Key. See: https://goo.gle/gemini-cli-docs-auth#gemini-api-key\n  ⚡ You can switch authentication methods by typing /auth\n✕ [API Error: Please submit a new query to continue with the Flash model.]\n\n\n╭────────╮\n│  > hi  │\n╰────────╯\n\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"Please ensure that the number of function response parts is equal to the number of function call parts of \n  the function call turn.\",\n      \"errors\": [\n        {\n          \"message\": \"Please ensure that the number of function response parts is equal to the number of function call parts \n  of the function call turn.\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]]\n\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"Please ensure that the number of function response parts is equal to the number of function call parts of \n  the function call turn.\",\n      \"errors\": [\n        {\n          \"message\": \"Please ensure that the number of function response parts is equal to the number of function call parts \n  of the function call turn.\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]]\n\n\nℹ Request cancelled.\n ","author":{"login":"CapyDojo"}},{"body":"any update on this please?  what should I do?","author":{"login":"CapyDojo"}},{"body":"> any update on this please? what should I do?\n\nIt looks like nothing so far, but I'm sure we'll get there! I totally understand—I've got the same issue, and I'm also waiting on this.","author":{"login":"raky6666"}}]}}},{"node":{"number":4607,"title":"gemini expecting image path, when we are just chatting","url":"https://github.com/google-gemini/gemini-cli/issues/4607","state":"OPEN","createdAt":"2025-07-21T16:25:23Z","body":"### What happened?\n\n\n  \"error\": {\n    \"message\": \"{\\\"error\\\":{\\\"message\\\":\\\"{\\\\n  \\\\\\\"error\\\\\\\": {\\\\n    \\\\\\\"code\\\\\\\": 400,\\\\n    \\\\\\\"message\\\\\\\": \\\\\\\"schema at anyOf.0 requires unspecified property 'image_path'\\\\\\\",\\\\n    \\\\\\\"status\\\\\\\": \\\\\\\"INVALID_ARGUMENT\\\\\\\"\\\\n  }\\\\n}\\\\n\\\",\\\"code\\\":400,\\\"status\\\":\\\"Bad Request\\\"}}\",\n    \"stack\": \"ApiError: {\\\"error\\\":{\\\"message\\\":\\\"{\\\\n  \\\\\\\"error\\\\\\\": {\\\\n    \\\\\\\"code\\\\\\\": 400,\\\\n    \\\\\\\"message\\\\\\\": \\\\\\\"schema at anyOf.0 requires unspecified property 'image_path'\\\\\\\",\\\\n    \\\\\\\"status\\\\\\\": \\\\\\\"INVALID_ARGUMENT\\\\\\\"\\\\n  }\\\\n}\\\\n\\\",\\\"code\\\":400,\\\"status\\\":\\\"Bad Request\\\"}}\\n    at throwErrorIfNotOK (file:///usr/local/lib/node_modules/@google/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13187:30)\\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at async file:///usr/local/lib/node_modules/@google/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:12978:13\\n    at async Models.generateContentStream (file:///usr/local/lib/node_modules/@google/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)\\n    at async retryWithBackoff (file:///usr/local/lib/node_modules/@google/gemini-cli/node_modules/@google/gemini-cli-core/dist/src/utils/retry.js:62:20)\\n    at async GeminiChat.sendMessageStream (file:///usr/local/lib/node_modules/@google/gemini-cli/node_modules/@google/gemini-cli-core/dist/src/core/geminiChat.js:303:36)\\n    at async Turn.run (file:///usr/local/lib/node_modules/@google/gemini-cli/node_modules/@google/gemini-cli-core/dist/src/core/turn.js:37:36)\\n    at async GeminiClient.sendMessageStream (file:///usr/local/lib/node_modules/@google/gemini-cli/node_modules/@google/gemini-cli-core/dist/src/core/client.js:248:26)\\n    at async file:///usr/local/lib/node_modules/@google/gemini-cli/dist/src/ui/hooks/useGeminiStream.js:284:26\\n    at async file:///usr/local/lib/node_modules/@google/gemini-cli/dist/src/ui/hooks/useGeminiStream.js:364:38\"\n  },\n  \"context\": [\n    {\n      \"role\": \"user\",\n      \"parts\": [\n        {\n          \"text\": \"This is the Gemini CLI. We are setting up the context for our chat.\\n  Today's date is Monday, July 21, 2025.\\n  My operating system is: darwin\\n  I'm currently working in the directory: /Users/omarbadran/orbit_workflow_automate\\n  Showing up to 200 items (files + folders).\\n\\n/Users/omarbadran/orbit_workflow_automate/\\n├───.env\\n├───README.md\\n└───.gemini/\\n    └───settings.json\"\n        }\n      ]\n    },\n    {\n      \"role\": \"model\",\n      \"parts\": [\n        {\n          \"text\": \"Got it. Thanks for the context!\"\n        }\n      ]\n    },\n    \"we ok?\"\n  ]\n}\n\n### What did you expect to happen?\n\njust have a regular chat, did not have any images for it to look at\n\n### Client information\n\n<details>\n\n```console\n About Gemini CLI                                                          │\n│                                                                           │\n│ CLI Version               0.1.13                                          │\n│ Git Commit                412b78c5 (local modifications)                  │\n│ Model                     gemini-2.5-pro                                  │\n│ Sandbox                   no sandbox                                      │\n│ OS                        darwin                                          │\n│ Auth Method               OAuth    \n```\n\n</details>\n\n\n### Login information\n\nI tried logging in with both my google account and api keys \n\n### Anything else we need to know?\n\n_No response_","comments":{"totalCount":1,"nodes":[{"body":"Am I reading the output correctly that you simply typed \"\"we ok?\" in an empty prompt in a repro with only a couple files to reproduce the issue?\nAre you able to reproduce consistently? I have not been able to reproduce so far and don't see any issues mentioning the issue and see no other bug reports mentioning this so it may have been a temporary bug on the Gemini backend side.\nIf you can reproduce would it be possible for you to share the orbit_wokflow_automate repo that is reproducing the issue or test whether you can reproduce for an empty repo?","author":{"login":"jacob314"}}]}}},{"node":{"number":4031,"title":"Linear MCP Server breaks tool-calling","url":"https://github.com/google-gemini/gemini-cli/issues/4031","state":"OPEN","createdAt":"2025-07-13T10:07:48Z","body":"\n## Describe the bug\n\nThe error:\n[API Error: got status: 400 Bad Request. {\"error\":{\"message\":\"{\\n  \\\"error\\\": {\\n    \\\"code\\\": 400,\\n    \\\"message\\\": \\\"* \n  GenerateContentRequest.tools[0].function_declarations[45].parameters.properties[links].items.properties[url].format: only 'enum' and 'date-time' are supported for STRING type\\\\n* \n  GenerateContentRequest.tools[0].function_declarations[46].parameters.properties[links].items.properties[url].format: only 'enum' and 'date-time' are supported for STRING type\\\\n\\\",\\n    \n  \\\"status\\\": \\\"INVALID_ARGUMENT\\\"\\n  }\\n}\\n\",\"code\":400,\"status\":\"Bad Request\"}}]\n\nLinear MCP Settings:\n\n{\n  \"mcpServers\": {\n    \"linear\": {\n      \"command\": \"npx\",\n      \"args\": [\"-y\", \"mcp-remote\", \"https://mcp.linear.app/sse\"]\n    }\n  }\n}\n\nWhen I added the linear mcp to my settings.json, it breaks the gemini cli tool calling. It works if i remove the linear mcp (so in general the tool calling works with other mcp servers).\n\n<img width=\"305\" height=\"519\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/bb5eb99b-42dd-497a-8403-7c2453dee754\" />\n\n\n## Diagnostic Information\n*   **CLI Version:** 0.1.0\n*   **Git Commit:** 852210e1 (local modifications)\n*   **Operating System:** darwin v22.14.0\n*   **Sandbox Environment:** no sandbox\n*   **Model Version:** gemini-2.5-pro\n*   **Memory Usage:** 103.6 MB\n","comments":{"totalCount":0,"nodes":[]}}},{"node":{"number":3753,"title":"API Errors - Code 400 when sending a prompt","url":"https://github.com/google-gemini/gemini-cli/issues/3753","state":"OPEN","createdAt":"2025-07-10T06:53:44Z","body":"### What happened?\n\nI rejected an edit file request from gemini cli and suddenly it started throwing errors from the next prompt infinitely until stopped. I have sent about 200+ prompts today (including rejecting a lot of responses) and no errors like this happened until now.\n```\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"Please ensure that the number of function response \n  parts is equal to the number of function call parts of the function\n   call turn.\",\n      \"errors\": [\n        {\n          \"message\": \"Please ensure that the number of function \n  response parts is equal to the number of function call parts of the\n   function call turn.\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]]\n```\n\nThis keeps happening in that session, I suspect until I quit the session and start a new one.\n\n### What did you expect to happen?\n\nExpect it to continue with the discussion and code changes.\n\n### Client information\n\n\n*   **CLI Version:** 0.1.9\n*   **Git Commit:** 34935d6\n*   **Operating System:** darwin v24.1.0\n*   **Sandbox Environment:** no sandbox\n*   **Model Version:** gemini-2.5-pro\n*   **Memory Usage:** 471.6 MB\n\n\n### Login information\n\nGoogle Account with Gemini Code Assist Standard plan.\n\n### Anything else we need to know?\n\n_No response_","comments":{"totalCount":8,"nodes":[{"body":"I want to add that saving and resuming that chat did not help either. Resuming that chat still throws those errors. i'm assuming my chat session just entered an inconsistent state that's unrecoverable. I don't really mind starting a new chat but the bug report might be helpful.","author":{"login":"mrcodepanda"}},{"body":"@mrcodepanda do you mind updating to the latest version `v0.1.10` and see if this still persists? \n\nWe made a fix in #3333 that hopefully fixes this 🤞 ","author":{"login":"jackwotherspoon"}},{"body":"I'm experiencing the same issue with version 0.1.10. The problem consistently arises after compressing the context, and it can only be resolved by starting a new chat.","author":{"login":"ElderDoge"}},{"body":"Having same issue. Loaded chats throws 400 when prompting. My version is 0.1.12 now","author":{"login":"emosGambler"}},{"body":"> Having same issue. Loaded chats throws 400 when prompting. My version is 0.1.12 now\n\n@emosGambler mind proving some reproducible steps? Will take a look into this closer if you can give me the commands you are running to reliably see this. 😄 ","author":{"login":"jackwotherspoon"}},{"body":"Possible duplicate of #3764?","author":{"login":"swissspidy"}},{"body":"I'm getting an error when I try to read a specific file.\n\ngemini -v : 0.1.12\nfile : vite.config.mts\n\n---\nexample 1)\n\n```\n╭────────────────────────────────────────────────────────────────────────────────────────────────╮\n │ ✔  ReadManyFiles Will attempt to read and concatenate files using patterns: `packages/core/v…  │\n │                                                                                                │\n │    ### ReadManyFiles Result (Target Dir:                                                       │\n │    `/Users/nhn/Documents/workspaces/nhn-cloud-ui`)                                             │\n │                                                                                                │\n │    Successfully read and concatenated content from **1 file(s)**.                              │\n │                                                                                                │\n │    **Processed Files:**                                                                        │\n │    - `packages/core/vite.config.mts`                                                           │\n ╰────────────────────────────────────────────────────────────────────────────────────────────────╯\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"Request contains an invalid argument.\",\n      \"errors\": [\n        {\n          \"message\": \"Request contains an invalid argument.\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]]\n```\n\n---\nexample 2)\n\n```\n╭────────────────────────────────────────────────────────────────────────────────────────────────╮\n │ ✔  ReadFile packages/core/vite.config.mts                                                      │\n │                                                                                                │\n │    Read video file: packages/core/vite.config.mts                                              │\n ╰────────────────────────────────────────────────────────────────────────────────────────────────╯\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"Request contains an invalid argument.\",\n      \"errors\": [\n        {\n          \"message\": \"Request contains an invalid argument.\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]]\n```\n\nand then...\n\nI asked gemini to print the file it read, but it gave me a different output than my original file. In fact, it was different from the `cat` command.","author":{"login":"chchoing88"}},{"body":"@chchoing88  I have this issue too, the `mts` file extension is interpreted as a video file (MPEG Transport Stream) instead of a typescript file. A workaround is to simply copying and pasting the contents of your vite.config.mts into the prompt, for me Gemini just continued from there.\n\n> I'm getting an error when I try to read a specific file.\n> \n> gemini -v : 0.1.12 file : vite.config.mts\n> \n","author":{"login":"sebastiancarlsson"}}]}}},{"node":{"number":1953,"title":"API Error: `Thinking_config.include_thoughts` when using `gemini -m gemini-2.5-flash-lite-preview-06-17`","url":"https://github.com/google-gemini/gemini-cli/issues/1953","state":"OPEN","createdAt":"2025-06-26T15:07:39Z","body":"### What happened?\n\nWhen attempting to use `gemini-2.5-flash-lite-preview-06-17` model, an API error occurs related to `Thinking_config.include_thoughts`.\n\n**Steps to Reproduce:**\n1. Run the following command in the terminal:\n   ```bash\n   gemini -m gemini-2.5-flash-lite-preview-06-17\n   ```\n2. Provide any input (e.g., `test`).\n\nThe command fails with an API error message.\n\n```\n✕ [API Error: {\"error\":{\"message\":\"{\n  \"error\": {\n    \"code\": 400,\n    \"message\": \"Unable to submit request because\n    Thinking_config.include_thoughts is only enabled when thinking is enabled..\n    Learn more: https://cloud.google.com/vertex-ai/generative-ai/docs/model-reference/gemini\",\n    \"status\": \"INVALID_ARGUMENT\"\n  }\n}\n\",\"code\":400,\"status\":\"Bad Request\"}}]\n```\n\n\n### What did you expect to happen?\n\nThe `gemini` command should process the input using the specified model without any API errors, and return a response.\n\n### Client information\n\n<details>\n\n```sh\n│ About Gemini CLI                                                        │\n│                                                                         │\n│ CLI Version              0.1.4                                          │\n│ Git Commit               1078a54                                        │\n│ Model                    gemini-2.5-flash-lite-preview-06-17            │\n│ Sandbox                  no sandbox                                     │\n│ OS                       linux                                          │\n\n```\n\n</details>\n\n\n### Login information\n\nVertex AI\n\n### Anything else we need to know?\n\n_No response_","comments":{"totalCount":2,"nodes":[{"body":"I think you need to enable thinking on your model first.","author":{"login":"sahil9001"}},{"body":"@sahil9001 what do you mean?","author":{"login":"ei-grad"}}]}}},{"node":{"number":1712,"title":"API Key always returned as invalid","url":"https://github.com/google-gemini/gemini-cli/issues/1712","state":"OPEN","createdAt":"2025-06-26T02:24:11Z","body":"### What happened?\n\nI moved to use an API key and I get an API_KEY_INVALID error. When I use the same api key in a curl request from the api key page it works no problem.\n\n```\n✕ [API Error: got status: 400 Bad Request. {\"error\":{\"message\":\"{\\n  \\\"error\\\": {\\n    \\\"code\\\": 400,\\n    \\\"message\\\": \\\"API key expired. \n  Please renew the API key.\\\",\\n    \\\"status\\\": \\\"INVALID_ARGUMENT\\\",\\n    \\\"details\\\": [\\n      {\\n        \\\"@type\\\": \n  \\\"type.googleapis.com/google.rpc.ErrorInfo\\\",\\n        \\\"reason\\\": \\\"API_KEY_INVALID\\\",\\n        \\\"domain\\\": \\\"googleapis.com\\\",\\n        \n  \\\"metadata\\\": {\\n          \\\"service\\\": \\\"generativelanguage.googleapis.com\\\"\\n        }\\n      },\\n      {\\n        \\\"@type\\\": \n  \\\"type.googleapis.com/google.rpc.LocalizedMessage\\\",\\n        \\\"locale\\\": \\\"en-US\\\",\\n        \\\"message\\\": \\\"API key expired. Please renew\n   the API key.\\\"\\n      }\\n    ]\\n  }\\n}\\n\",\"code\":400,\"status\":\"Bad Request\"}}]\n```\n\n### What did you expect to happen?\n\nThe client to work correctly\n\n### Client information\n\n<details>\n\n```console\n$ gemini /about\n│ CLI Version                0.1.1                                              │\n│ Git Commit                 852210e1 (local modifications)                     │\n│ Model                      gemini-2.5-pro                                     │\n│ Sandbox                    no sandbox                                         │\n│ OS                         darwin  ```\n\n</details>\n\n\n### Login information\n\n_No response_\n\n### Anything else we need to know?\n\n_No response_","comments":{"totalCount":1,"nodes":[{"body":"Is this still happening to you? How/where did you create the API key?","author":{"login":"swissspidy"}}]}}},{"node":{"number":4536,"title":"GhidraMCP service fails with \"Invalid function name\" error when used standalone, but works in VS Code","url":"https://github.com/google-gemini/gemini-cli/issues/4536","state":"OPEN","createdAt":"2025-07-20T05:33:00Z","body":"### What happened?\n\n### Describe the bug\n\nWhen using `gemini-cli` to connect to a GhidraMCP service, it fails with a `400 INVALID_ARGUMENT` error, specifically `Invalid function name`. However, the exact same GhidraMCP service works perfectly when accessed through the official Google Gemini extension in VS Code, which I understand is also powered by `gemini-cli`.\n\nThis suggests there is a difference in how `gemini-cli` processes or sanitizes function declarations from GhidraMCP when run standalone versus when it's integrated into the VS Code extension.\n\n### Steps to Reproduce\n\n1.  Set up a GhidraMCP server instance.\n2.  Configure standalone `gemini-cli` to connect to this GhidraMCP service by adding it to the `tools` configuration.\n3.  Attempt to use a feature that calls a GhidraMCP function via a prompt (e.g., `@ghidra decompile`).\n4.  The command fails and returns the API error.\n5.  Now, open VS Code with the Google Gemini extension.\n6.  Configure the extension to point to the *same* GhidraMCP service endpoint.\n7.  Use the chat feature in VS Code and make the same request (e.g., `@ghidra decompile`).\n8.  The request succeeds, and the result from Ghidra is returned as expected.\n\n### Expected Behavior\n\nThe standalone `gemini-cli` should be able to communicate with the GhidraMCP service without errors, just as it does when integrated within the VS Code extension. It should likely perform the same function name sanitization or validation before sending the request to the Gemini API.\n\n### Actual Behavior\n\nThe standalone `gemini-cli` throws the following API error, preventing any interaction with the GhidraMCP service.\n\n```json\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"The GenerateContentRequest proto is invalid:\\n  * \n  tools.function_declarations.name: [FIELD_INVALID] Invalid function name. Must start with \n  a letter or an underscore. Must be a-z, A-Z, 0-9, or contain underscores, dots and dashes, with \n  a maximum length of 64.\",\n      \"errors\": [\n        {\n          \"message\": \"The GenerateContentRequest proto is invalid:\\n  * \n  tools.function_declarations.name: [FIELD_INVALID] Invalid function name. Must start with \n  a letter or an underscore. Must be a-z, A-Z, 0-9, or contain underscores, dots and dashes, with \n  a maximum length of 64.\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n]]\n\n### What did you expect to happen?\n\nThe standalone `gemini-cli` should be able to communicate with the GhidraMCP service without errors, just as it does when integrated within the VS Code extension. It should likely perform the same function name sanitization or validation before sending the request to the Gemini API.\n\nWhen I execute a command targeting the GhidraMCP tool (e.g., `@ghidra decompile`), I expect the command to be processed successfully and the output from Ghidra to be displayed in my terminal, not an API error.\n\n### Client information\n\nAbout Gemini CLI                                         │\n│                                                          │\n│ CLI Version         0.1.13                               │\n│ Model               gemini-2.5-pro                       │\n│ Sandbox             no sandbox                           │\n│ OS                  linux                                │\n│ Auth Method         OAuth                                │\n\n### Login information\n\n_No response_\n\n### Anything else we need to know?\n\n_No response_","comments":{"totalCount":1,"nodes":[{"body":"Could you please provide a few more details:\n\n1) Version of Gemini Code Assist extension\n2) /auth type being used for gemini-cli","author":{"login":"skeshive"}}]}}},{"node":{"number":4430,"title":"API renew after just using for 1 hour , How do i fix it?","url":"https://github.com/google-gemini/gemini-cli/issues/4430","state":"OPEN","createdAt":"2025-07-18T03:28:06Z","body":"### What happened?\n\nFirst time using gemini cli, Built an android project for about one hour. \n\nUsage details tells me i used up 3 million input tokens. \n\nBut in bottom right of cli i am seeing 100% context left.\n\nThis is the error i get \n\n```\n\"[API Error: {\"error\":{\"message\":\"{\\n  \\\"error\\\": {\\n    \\\"code\\\": 400,\\n    \\\"message\\\": \\\"API key expired. Please renew the API key.\\\",\\n    \\\"status\\\": \\\"INVALID_ARGUMENT\\\",\\n    \\\"details\\\": [\\n \n       {\\n        \\\"@type\\\": \\\"type.googleapis.com/google.rpc.ErrorInfo\\\",\\n        \\\"reason\\\": \\\"API_KEY_INVALID\\\",\\n        \\\"domain\\\": \\\"googleapis.com\\\",\\n        \\\"metadata\\\": {\\n          \n  \\\"service\\\": \\\"generativelanguage.googleapis.com\\\"\\n        }\\n      },\\n      {\\n        \\\"@type\\\": \\\"type.googleapis.com/google.rpc.LocalizedMessage\\\",\\n        \\\"locale\\\": \\\"en-US\\\",\\n        \n  \\\"message\\\": \\\"API key expired. Please renew the API key.\\\"\\n      }\\n    ]\\n  }\\n}\\n\",\"code\":400,\"status\":\"Bad Request\"}}]\n```\n\nI have tried to use a newly generated api key from ai studio and still same problems.\n\nPlease help me fix it.\n\n### What did you expect to happen?\n\nI expected to continue using gemini CLI\n\n### Client information\n\n<details>\n\n```console\n$ gemini /about\n# About Gemini CLI                                                                   │\n│                                                                                    │\n│ CLI Version                  0.1.12                                                │\n│ Model                        gemini-2.5-pro                                        │\n│ Sandbox                      no sandbox                                            │\n│ OS                           linux                                                 │\n│ Auth Method                  gemini-api-key          \n```\n\n</details>\n\n\n### Login information\n\nAuth\n\n### Anything else we need to know?\n\nThe context window seems to be very misleading. I used 3 million input tokens in 1 hour and it just kept saying i still had 95% usage left. ","comments":{"totalCount":0,"nodes":[]}}},{"node":{"number":3621,"title":"CLI stuck when running `npm test -- --watchAll=false`","url":"https://github.com/google-gemini/gemini-cli/issues/3621","state":"OPEN","createdAt":"2025-07-09T10:31:55Z","body":"### What happened?\n\nI asked the CLI to run `npm test -- --watchAll=false` and fix errors. The CLI shows a block of shell command and it runs the test command in the block. When tests are finished, the CLI still waits for the result, without moving to next steps. It has waited for over 10 minutes, while the test output in the block says test finished. Then I exited the CLI.\n\n### What did you expect to happen?\n\nWhen the test finishes, CLI should read the output and move on.\n\n### Client information\n\n<details>\n\n```console\n About Gemini CLI                                                                                                         │\n│                                                                                                                          │\n│ CLI Version                               0.1.7                                                                          │\n│ Git Commit                                55cc809                                                                        │\n│ Model                                     gemini-2.5-pro                                                                 │\n│ Sandbox                                   no sandbox                                                                     │\n│ OS                                        linux                                                                          │\n│ Auth Method                               OAuth  \n```\n\n</details>\n\nError displayed\n\n```\n │    Time:        5.602 s                                                                                                                          │\n │    Ran all test suites.                                                                                                                          │\n │                                                                                                                                                  │\n ╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"The input token count (1158175) exceeds the maximum number of tokens allowed (1048576).\",\n      \"errors\": [\n        {\n          \"message\": \"The input token count (1158175) exceeds the maximum number of tokens allowed (1048576).\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]]\n```\n\nGot debug error:\n\n```\n│ Debug Console (ctrl+o to close)                                                                                                              │\n│                                                                                                                                              │\n│ ... first 493 lines hidden ...                                                                                                               │\n│          'x-xss-protection': '0'                                                                                                             │\n│        },                                                                                                                                    │\n│        status: 400,                                                                                                                          │\n│        statusText: 'Bad Request',                                                                                                            │\n│        request: {                                                                                                                            │\n│          responseURL: 'https://cloudcode-pa.googleapis.com/v1internal:streamGenerateContent?alt=sse'                                         │\n│        }                                                                                                                                     │\n│      },                                                                                                                                      │\n│      error: undefined,                                                                                                                       │\n│      status: 400,                                                                                                                            │\n│      [Symbol(gaxios-gaxios-error)]: '6.7.1'                                                                                                  │\n```\n\n### Login information\n\n_No response_\n\n### Anything else we need to know?\n\n[gemini-client-error-Turn.run-sendMessageStream-2025-07-09T10-27-01-253Z.json](https://github.com/user-attachments/files/21140613/gemini-client-error-Turn.run-sendMessageStream-2025-07-09T10-27-01-253Z.json)","comments":{"totalCount":0,"nodes":[]}}},{"node":{"number":4427,"title":"invalid argument badrequest after tool call deauthorization","url":"https://github.com/google-gemini/gemini-cli/issues/4427","state":"OPEN","createdAt":"2025-07-18T02:32:31Z","body":"### What happened?\n\n```\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"Please ensure that the number of function response parts is equal to the number of function call parts of the \n  function call turn.\",\n      \"errors\": [\n        {\n          \"message\": \"Please ensure that the number of function response parts is equal to the number of function call parts of the \n  function call turn.\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]]\n```\never see a terminal interface flashbang of like 20 of these in a row? well i sure have!\ntake note that the gemini-cli chat history is totally ruined once one of these show up, and unless there's a history-healing tool i don't know about, you're forced to reconstruct in-context-learning 'agent prefills' you were working through de novo, because...\n\n```\n│  > /compress  │\n╰───────────────╯\n\n✕ Failed to compress chat history: Please ensure that the number of function response parts is equal to the number of function call \n  parts of the function call turn.\n```\nthis continuation error stops you from using the gemini instance to purge the incompatible context from the session!\n\n### What did you expect to happen?\n\nthis interaction with gemini flash might have cost me like 10 cents in cloud credits... but far more than that cost in scarce attention on a project i really want done on short timelines, so, hey. it would be nice if i never saw this error again for the rest of my life, you know?\n\n### Client information\n\n\n*   **CLI Version:** 0.1.9\n*   **Git Commit:** 34935d6\n*   **Operating System:** win32 v18.12.1\n*   **Sandbox Environment:** no sandbox\n*   **Model Version:** gemini-2.5-flash\n*   **Memory Usage:** 108.3 MB\n\n\n### Login information\n\n_No response_\n\n### Anything else we need to know?\n\n_No response_","comments":{"totalCount":0,"nodes":[]}}},{"node":{"number":4127,"title":"MCP: support integer enums","url":"https://github.com/google-gemini/gemini-cli/issues/4127","state":"OPEN","createdAt":"2025-07-14T13:35:20Z","body":"Our MCP server uses this openapi schema:\n\n```json\n      \"Phases\": {\n        \"description\": \"Number of phases. (0: auto, 1: 1-phase, 3: 3-phase) [Read more.](https://docs.evcc.io/en/docs/reference/configuration/loadpoints#phases)\\n\",\n        \"enum\": [\n          0,\n          1,\n          3\n        ],\n        \"example\": 3,\n        \"type\": \"integer\"\n      },\n```\n\nthis leads, when running an MCP tool, to:\n\n```\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"Invalid value at 'request.tools[0].function_declarations[43].parameters.properties[1].value.enum[0]' (TYPE_STRING), 0\\nInvalid value at \n  'request.tools[0].function_declarations[43].parameters.properties[1].value.enum[1]' (TYPE_STRING), 1\\nInvalid value at \n  'request.tools[0].function_declarations[43].parameters.properties[1].value.enum[2]' (TYPE_STRING), 3\",\n      \"errors\": [\n        {\n          \"message\": \"Invalid value at 'request.tools[0].function_declarations[43].parameters.properties[1].value.enum[0]' (TYPE_STRING), 0\\nInvalid value at \n  'request.tools[0].function_declarations[43].parameters.properties[1].value.enum[1]' (TYPE_STRING), 1\\nInvalid value at \n  'request.tools[0].function_declarations[43].parameters.properties[1].value.enum[2]' (TYPE_STRING), 3\",\n          \"reason\": \"invalid\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\",\n      \"details\": [\n        {\n          \"@type\": \"type.googleapis.com/google.rpc.BadRequest\",\n          \"fieldViolations\": [\n            {\n              \"field\": \"request.tools[0].function_declarations[43].parameters.properties[1].value.enum[0]\",\n              \"description\": \"Invalid value at 'request.tools[0].function_declarations[43].parameters.properties[1].value.enum[0]' (TYPE_STRING), 0\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[43].parameters.properties[1].value.enum[1]\",\n              \"description\": \"Invalid value at 'request.tools[0].function_declarations[43].parameters.properties[1].value.enum[1]' (TYPE_STRING), 1\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[43].parameters.properties[1].value.enum[2]\",\n              \"description\": \"Invalid value at 'request.tools[0].function_declarations[43].parameters.properties[1].value.enum[2]' (TYPE_STRING), 3\"\n            }\n          ]\n        }\n      ]\n    }\n  }\n  ]]\n```\n\nIt looks as if integer enums are not supported.","comments":{"totalCount":5,"nodes":[{"body":"@google-gemini note the actions failure for this issue: https://github.com/google-gemini/gemini-cli/actions/runs/16268351764/job/45929316364","author":{"login":"andig"}},{"body":"I _think_ this is is similar to #4400-- consolidating by closing as duplicate but feel free to re-open if it's distinct","author":{"login":"chrstnb"}},{"body":"(see explanation in #4400 for why I re-opened this)","author":{"login":"jakemac53"}},{"body":"Thanks for reopening.\n\n> But https://github.com/google-gemini/gemini-cli/issues/4127 should be re-opened, although I am not sure if MCP in general is intended to support integer enums, that is a different question.\n\nIn hour case we‘re just exposing the rest api as mcp. As long as not forbidden by json schema I‘d expect them to be supported?","author":{"login":"andig"}},{"body":"[JSON schema](https://json-schema.org/understanding-json-schema/reference/enum) does allow mixed types. The only restriction I see in MCP is for the primitive [EnumSchema](https://github.com/modelcontextprotocol/modelcontextprotocol/blob/main/schema/2025-06-18/schema.json#L679) which only applies to elicitations.","author":{"login":"jakemac53"}}]}}},{"node":{"number":4403,"title":"Checkpoint save race condition can result in function call/response mismatch after restore","url":"https://github.com/google-gemini/gemini-cli/issues/4403","state":"OPEN","createdAt":"2025-07-17T19:35:32Z","body":"## Problem\n\nWhen using `/chat save` to checkpoint a session, the Gemini CLI may serialize the chat history while asynchronous tool executions (function calls) are still pending. This can result in a checkpoint file (JSON) where the number of function call parts does not match the number of function response parts for one or more turns. When restoring such a checkpoint with `/chat resume`, the CLI attempts to use this history, which triggers API errors such as:\n\n```\nAPI Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"Please ensure that the number of function response parts is equal to the number of function call parts of the function call turn.\",\n      \"errors\": [\n        {\n          \"message\": \"Please ensure that the number of function response parts is equal to the number of function call parts of the function call turn.\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]\n```\n\n## Reproduction Steps\n\n1. Start a chat session and trigger a tool (function call) that takes a noticeable time to complete.\n2. While the UI appears idle (prompt available), immediately run `/chat save <tag>`.\n3. Exit and restart Gemini CLI.\n4. Run `/chat resume <tag>`.\n5. Attempt any further interaction and observe API error or erratic model behavior.\n\n## Expected Behavior\n- Checkpointing should only serialize chat history when all asynchronous requests are complete, _or_ should insert pending stubs for any in-flight function calls to maintain function call/response count invariants.\n- Restoring from a checkpoint should never result in a function call/response mismatch or API errors from the Gemini backend.\n\n## Actual Behavior\n- The CLI can save checkpoints with incomplete function call/response pairs, resulting in API errors or undefined behavior after `/chat resume`.\n\n## Suggested Fix\n- Before writing a checkpoint, block until all tool executions and function calls are complete.\n- Alternatively, serialize incomplete turns with explicit pending stubs and handle them gracefully on restore (e.g., re-trigger the tool call or prompt the user).\n\n## Additional Info\nnone\n\n---\n**Please prioritize this as it can corrupt user sessions and lead to unrecoverable API errors.**\n","comments":{"totalCount":1,"nodes":[{"body":"This should be fixed in the new system my PR #4401 introduces.","author":{"login":"bl-ue"}}]}}},{"node":{"number":4442,"title":"Gemini-CLI Compression Error","url":"https://github.com/google-gemini/gemini-cli/issues/4442","state":"OPEN","createdAt":"2025-07-18T07:48:07Z","body":"### What happened?\n\nThe error occurs because my input exceeds the token limit for the Gemini 2.5 Flash model, even after compression. Here's a breakdown:\n\nKey Issue:\nGemini 2.5 Flash's token limit: 1,048,576 tokens (as stated in the error).\n\nYour compressed input: 1,624,359 tokens (per the error message).\n\nResult: Your input is ~576,000 tokens over the limit.\n\n\nWhat is the reason for this error?\n\n### What did you expect to happen?\n\nFix Compression Logic\n\n### Client information\n\nThis are the errors am seeing: \n1. ℹ IMPORTANT: This conversation approached the input token limit for gemini-2.5-flash. A compressed context\n  will be sent for future messages (compressed from: 905405 to 1811387 tokens).\n✕ [API Error: {\"error\":{\"message\":\"{\\n  \\\"error\\\": {\\n    \\\"code\\\": 429,\\n    \\\"message\\\": \\\"You exceeded your\n   current quota, please check your plan and billing details. For more information on this error, head to:\n  https://ai.google.dev/gemini-api/docs/rate-limits.\\\",\\n    \\\"status\\\": \\\"RESOURCE_EXHAUSTED\\\",\\n\n  \\\"details\\\": [\\n      {\\n        \\\"@type\\\": \\\"type.googleapis.com/google.rpc.QuotaFailure\\\",\\n\n  \\\"violations\\\": [\\n          {\\n            \\\"quotaMetric\\\":\n  \\\"generativelanguage.googleapis.com/generate_content_free_tier_input_token_count\\\",\\n\n  \\\"quotaId\\\": \\\"GenerateContentInputTokensPerModelPerMinute-FreeTier\\\",\\n            \\\"quotaDimensions\\\": {\\n\n                \\\"location\\\": \\\"global\\\",\\n              \\\"model\\\": \\\"gemini-2.5-flash\\\"\\n            },\\n\n          \\\"quotaValue\\\": \\\"250000\\\"\\n          }\\n        ]\\n      },\\n      {\\n        \\\"@type\\\":\n  \\\"type.googleapis.com/google.rpc.Help\\\",\\n        \\\"links\\\": [\\n          {\\n            \\\"description\\\":\n  \\\"Learn more about Gemini API quotas\\\",\\n            \\\"url\\\":\n  \\\"https://ai.google.dev/gemini-api/docs/rate-limits\\\"\\n          }\\n        ]\\n      },\\n      {\\n\n  \\\"@type\\\": \\\"type.googleapis.com/google.rpc.RetryInfo\\\",\\n        \\\"retryDelay\\\": \\\"28s\\\"\\n      }\\n    ]\\n\n   }\\n}\\n\",\"code\":429,\"status\":\"Too Many Requests\"}}]\n  Please wait and try again later. To increase your limits, request a quota increase through AI Studio, or\n  switch to another /auth method\n\n2. ℹ IMPORTANT: This conversation approached the input token limit for gemini-2.5-flash. A compressed context\n  will be sent for future messages (compressed from: 905405 to 1811212 tokens).\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"The input token count (1624359) exceeds the maximum number of tokens allowed (1048576).\",\n      \"errors\": [\n        {\n          \"message\": \"The input token count (1624359) exceeds the maximum number of tokens allowed\n  (1048576).\",\n          \"domain\": \"global\",\n          \"reason\": \"badRequest\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\"\n    }\n  }\n  ]].\n\n\n### Login information\n\nGoogle Account, then later Google API\n\n### Anything else we need to know?\n\n_No response_","comments":{"totalCount":0,"nodes":[]}}},{"node":{"number":4120,"title":"not working","url":"https://github.com/google-gemini/gemini-cli/issues/4120","state":"OPEN","createdAt":"2025-07-14T12:44:09Z","body":"### What happened?\n\n\n╭──────────────────────────────────────────╮\n│  > 이 프로젝트 구조를 이해할 수 있겠어?  │\n╰──────────────────────────────────────────╯\n\n✕ [API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"Invalid value at 'request.tools[0].function_declarations[188].parameters.properties[3].value.enum[0]'\n  (TYPE_STRING), 1\\nInvalid value at 'request.tools[0].function_declarations[188].parameters.properties[3].value.enum[1]'\n  (TYPE_STRING), 2\\nInvalid value at 'request.tools[0].function_declarations[188].parameters.properties[3].value.enum[2]'\n  (TYPE_STRING), 3\\nInvalid value at 'request.tools[0].function_declarations[188].parameters.properties[3].value.enum[3]'\n  (TYPE_STRING), 4\\nInvalid value at 'request.tools[0].function_declarations[189].parameters.properties[2].value.enum[0]'\n  (TYPE_STRING), 1\\nInvalid value at 'request.tools[0].function_declarations[189].parameters.properties[2].value.enum[1]'\n  (TYPE_STRING), 2\\nInvalid value at 'request.tools[0].function_declarations[189].parameters.properties[2].value.enum[2]'\n  (TYPE_STRING), 3\\nInvalid value at 'request.tools[0].function_declarations[189].parameters.properties[2].value.enum[3]'\n  (TYPE_STRING), 4\\nInvalid value at 'request.tools[0].function_declarations[190].parameters.properties[4].value.enum[0]'\n  (TYPE_STRING), 1\\nInvalid value at 'request.tools[0].function_declarations[190].parameters.properties[4].value.enum[1]'\n  (TYPE_STRING), 2\\nInvalid value at 'request.tools[0].function_declarations[190].parameters.properties[4].value.enum[2]'\n  (TYPE_STRING), 3\\nInvalid value at 'request.tools[0].function_declarations[190].parameters.properties[4].value.enum[3]'\n  (TYPE_STRING), 4\",\n      \"errors\": [\n        {\n          \"message\": \"Invalid value at 'request.tools[0].function_declarations[188].parameters.properties[3].value.enum[0]'\n  (TYPE_STRING), 1\\nInvalid value at 'request.tools[0].function_declarations[188].parameters.properties[3].value.enum[1]'\n  (TYPE_STRING), 2\\nInvalid value at 'request.tools[0].function_declarations[188].parameters.properties[3].value.enum[2]'\n  (TYPE_STRING), 3\\nInvalid value at 'request.tools[0].function_declarations[188].parameters.properties[3].value.enum[3]'\n  (TYPE_STRING), 4\\nInvalid value at 'request.tools[0].function_declarations[189].parameters.properties[2].value.enum[0]'\n  (TYPE_STRING), 1\\nInvalid value at 'request.tools[0].function_declarations[189].parameters.properties[2].value.enum[1]'\n  (TYPE_STRING), 2\\nInvalid value at 'request.tools[0].function_declarations[189].parameters.properties[2].value.enum[2]'\n  (TYPE_STRING), 3\\nInvalid value at 'request.tools[0].function_declarations[189].parameters.properties[2].value.enum[3]'\n  (TYPE_STRING), 4\\nInvalid value at 'request.tools[0].function_declarations[190].parameters.properties[4].value.enum[0]'\n  (TYPE_STRING), 1\\nInvalid value at 'request.tools[0].function_declarations[190].parameters.properties[4].value.enum[1]'\n  (TYPE_STRING), 2\\nInvalid value at 'request.tools[0].function_declarations[190].parameters.properties[4].value.enum[2]'\n  (TYPE_STRING), 3\\nInvalid value at 'request.tools[0].function_declarations[190].parameters.properties[4].value.enum[3]'\n  (TYPE_STRING), 4\",\n          \"reason\": \"invalid\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\",\n      \"details\": [\n        {\n          \"@type\": \"type.googleapis.com/google.rpc.BadRequest\",\n          \"fieldViolations\": [\n            {\n              \"field\": \"request.tools[0].function_declarations[188].parameters.properties[3].value.enum[0]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[188].parameters.properties[3].value.enum[0]' (TYPE_STRING), 1\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[188].parameters.properties[3].value.enum[1]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[188].parameters.properties[3].value.enum[1]' (TYPE_STRING), 2\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[188].parameters.properties[3].value.enum[2]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[188].parameters.properties[3].value.enum[2]' (TYPE_STRING), 3\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[188].parameters.properties[3].value.enum[3]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[188].parameters.properties[3].value.enum[3]' (TYPE_STRING), 4\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[189].parameters.properties[2].value.enum[0]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[189].parameters.properties[2].value.enum[0]' (TYPE_STRING), 1\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[189].parameters.properties[2].value.enum[1]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[189].parameters.properties[2].value.enum[1]' (TYPE_STRING), 2\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[189].parameters.properties[2].value.enum[2]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[189].parameters.properties[2].value.enum[2]' (TYPE_STRING), 3\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[189].parameters.properties[2].value.enum[3]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[189].parameters.properties[2].value.enum[3]' (TYPE_STRING), 4\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[190].parameters.properties[4].value.enum[0]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[190].parameters.properties[4].value.enum[0]' (TYPE_STRING), 1\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[190].parameters.properties[4].value.enum[1]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[190].parameters.properties[4].value.enum[1]' (TYPE_STRING), 2\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[190].parameters.properties[4].value.enum[2]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[190].parameters.properties[4].value.enum[2]' (TYPE_STRING), 3\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[190].parameters.properties[4].value.enum[3]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[190].parameters.properties[4].value.enum[3]' (TYPE_STRING), 4\"\n            }\n          ]\n        }\n      ]\n    }\n  }\n  ]]\n-----\nthis korean is: \"can you understand this project structure?\"\nanyway, from gemini version 1.0.9 to now(1.0.12), this situation happend.\n\n### What did you expect to happen?\n\njust answer of gemini\n\n### Client information\n\n\n*   **CLI Version:** 0.1.12\n*   **Git Commit:** b29c02dd (local modifications)\n*   **Operating System:** win32 v22.17.0\n*   **Sandbox Environment:** no sandbox\n*   **Model Version:** gemini-2.5-pro\n*   **Memory Usage:** 138.8 MB\n\n\n### Login information\n\n_No response_\n\n### Anything else we need to know?\n\n_No response_","comments":{"totalCount":1,"nodes":[{"body":"Current MCP Servers are all coded according to the set standards, but Gemini uses a very strict chain transmission method, so it will report errors and cannot be used. I think the problem is that Gemini does not update to the latest method. Its creator is extremely conservative in his views. It's really trash.The only way to fix this is to pull the projects back and edit them yourself, edit the enums to the strings that gemini accepts, or replace the method completely","author":{"login":"smarthomeblack"}}]}}},{"node":{"number":4415,"title":"MCP Server Error: Invalid value at ... INVALID_ARGUMENT (azure-devops-mcp)","url":"https://github.com/google-gemini/gemini-cli/issues/4415","state":"OPEN","createdAt":"2025-07-17T22:42:03Z","body":"### What happened?\n\nThe mcp server https://github.com/microsoft/azure-devops-mcp is not working\n\nI reviewed the list of open issues and found this one is similar to several others I've seen involving an MCP Server. However, this one provides more data. I hope this helps you understand what is happening so we can find a solution soon.\n\nFull Error:\n \n[API Error: [{\n    \"error\": {\n      \"code\": 400,\n      \"message\": \"Invalid value at\n  'request.tools[0].function_declarations[16].parameters.properties[5].value.enum[0]' (TYPE_STRING),\n  0\\nInvalid value at 'request.tools[0].function_declarations[16].parameters.properties[5].value.enum[1]'\n  (TYPE_STRING), 1\\nInvalid value at\n  'request.tools[0].function_declarations[16].parameters.properties[5].value.enum[2]' (TYPE_STRING),\n  2\\nInvalid value at 'request.tools[0].function_declarations[16].parameters.properties[5].value.enum[3]'\n  (TYPE_STRING), 3\\nInvalid value at\n  'request.tools[0].function_declarations[16].parameters.properties[5].value.enum[4]' (TYPE_STRING),\n  4\\nInvalid value at 'request.tools[0].function_declarations[18].parameters.properties[16].value.enum[0]'\n  (TYPE_STRING), 2\\nInvalid value at\n  'request.tools[0].function_declarations[18].parameters.properties[16].value.enum[1]' (TYPE_STRING),\n  3\\nInvalid value at 'request.tools[0].function_declarations[18].parameters.properties[16].value.enum[2]'\n  (TYPE_STRING), 4\\nInvalid value at\n  'request.tools[0].function_declarations[18].parameters.properties[16].value.enum[3]' (TYPE_STRING),\n  5\\nInvalid value at 'request.tools[0].function_declarations[18].parameters.properties[16].value.enum[4]'\n  (TYPE_STRING), 6\\nInvalid value at\n  'request.tools[0].function_declarations[18].parameters.properties[16].value.enum[5]' (TYPE_STRING),\n  7\\nInvalid value at 'request.tools[0].function_declarations[24].parameters.properties[3].value.enum[0]'\n  (TYPE_STRING), 0\\nInvalid value at\n  'request.tools[0].function_declarations[24].parameters.properties[3].value.enum[1]' (TYPE_STRING),\n  1\\nInvalid value at 'request.tools[0].function_declarations[24].parameters.properties[3].value.enum[2]'\n  (TYPE_STRING), 2\\nInvalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[2].value.enum[0]' (TYPE_STRING),\n  0\\nInvalid value at 'request.tools[0].function_declarations[59].parameters.properties[2].value.enum[1]'\n  (TYPE_STRING), 2\\nInvalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[2].value.enum[2]' (TYPE_STRING),\n  4\\nInvalid value at 'request.tools[0].function_declarations[59].parameters.properties[2].value.enum[3]'\n  (TYPE_STRING), 8\\nInvalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[2].value.enum[4]' (TYPE_STRING),\n  16\\nInvalid value at 'request.tools[0].function_declarations[59].parameters.properties[2].value.enum[5]'\n  (TYPE_STRING), 32\\nInvalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[2].value.enum[6]' (TYPE_STRING),\n  64\\nInvalid value at 'request.tools[0].function_declarations[59].parameters.properties[7].value.enum[0]'\n  (TYPE_STRING), 0\\nInvalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[7].value.enum[1]' (TYPE_STRING),\n  1\\nInvalid value at 'request.tools[0].function_declarations[59].parameters.properties[7].value.enum[2]'\n  (TYPE_STRING), 2\\nInvalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[7].value.enum[3]' (TYPE_STRING),\n  3\\nInvalid value at 'request.tools[0].function_declarations[60].parameters.properties[5].value.enum[0]'\n  (TYPE_STRING), 0\\nInvalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[5].value.enum[1]' (TYPE_STRING),\n  1\\nInvalid value at 'request.tools[0].function_declarations[60].parameters.properties[5].value.enum[2]'\n  (TYPE_STRING), 2\\nInvalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[5].value.enum[3]' (TYPE_STRING),\n  4\\nInvalid value at 'request.tools[0].function_declarations[60].parameters.properties[9].value.enum[0]'\n  (TYPE_STRING), 0\\nInvalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[9].value.enum[1]' (TYPE_STRING),\n  1\\nInvalid value at 'request.tools[0].function_declarations[60].parameters.properties[12].value.enum[0]'\n  (TYPE_STRING), 0\\nInvalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[12].value.enum[1]' (TYPE_STRING),\n  2\\nInvalid value at 'request.tools[0].function_declarations[60].parameters.properties[12].value.enum[2]'\n  (TYPE_STRING), 4\\nInvalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[12].value.enum[3]' (TYPE_STRING),\n  8\\nInvalid value at 'request.tools[0].function_declarations[60].parameters.properties[12].value.enum[4]'\n  (TYPE_STRING), 16\\nInvalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[12].value.enum[5]' (TYPE_STRING),\n  32\\nInvalid value at 'request.tools[0].function_declarations[60].parameters.properties[12].value.enum[6]'\n  (TYPE_STRING), 64\",\n      \"errors\": [\n        {\n          \"message\": \"Invalid value at\n  'request.tools[0].function_declarations[16].parameters.properties[5].value.enum[0]' (TYPE_STRING),\n  0\\nInvalid value at 'request.tools[0].function_declarations[16].parameters.properties[5].value.enum[1]'\n  (TYPE_STRING), 1\\nInvalid value at\n  'request.tools[0].function_declarations[16].parameters.properties[5].value.enum[2]' (TYPE_STRING),\n  2\\nInvalid value at 'request.tools[0].function_declarations[16].parameters.properties[5].value.enum[3]'\n  (TYPE_STRING), 3\\nInvalid value at\n  'request.tools[0].function_declarations[16].parameters.properties[5].value.enum[4]' (TYPE_STRING),\n  4\\nInvalid value at 'request.tools[0].function_declarations[18].parameters.properties[16].value.enum[0]'\n  (TYPE_STRING), 2\\nInvalid value at\n  'request.tools[0].function_declarations[18].parameters.properties[16].value.enum[1]' (TYPE_STRING),\n  3\\nInvalid value at 'request.tools[0].function_declarations[18].parameters.properties[16].value.enum[2]'\n  (TYPE_STRING), 4\\nInvalid value at\n  'request.tools[0].function_declarations[18].parameters.properties[16].value.enum[3]' (TYPE_STRING),\n  5\\nInvalid value at 'request.tools[0].function_declarations[18].parameters.properties[16].value.enum[4]'\n  (TYPE_STRING), 6\\nInvalid value at\n  'request.tools[0].function_declarations[18].parameters.properties[16].value.enum[5]' (TYPE_STRING),\n  7\\nInvalid value at 'request.tools[0].function_declarations[24].parameters.properties[3].value.enum[0]'\n  (TYPE_STRING), 0\\nInvalid value at\n  'request.tools[0].function_declarations[24].parameters.properties[3].value.enum[1]' (TYPE_STRING),\n  1\\nInvalid value at 'request.tools[0].function_declarations[24].parameters.properties[3].value.enum[2]'\n  (TYPE_STRING), 2\\nInvalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[2].value.enum[0]' (TYPE_STRING),\n  0\\nInvalid value at 'request.tools[0].function_declarations[59].parameters.properties[2].value.enum[1]'\n  (TYPE_STRING), 2\\nInvalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[2].value.enum[2]' (TYPE_STRING),\n  4\\nInvalid value at 'request.tools[0].function_declarations[59].parameters.properties[2].value.enum[3]'\n  (TYPE_STRING), 8\\nInvalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[2].value.enum[4]' (TYPE_STRING),\n  16\\nInvalid value at 'request.tools[0].function_declarations[59].parameters.properties[2].value.enum[5]'\n  (TYPE_STRING), 32\\nInvalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[2].value.enum[6]' (TYPE_STRING),\n  64\\nInvalid value at 'request.tools[0].function_declarations[59].parameters.properties[7].value.enum[0]'\n  (TYPE_STRING), 0\\nInvalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[7].value.enum[1]' (TYPE_STRING),\n  1\\nInvalid value at 'request.tools[0].function_declarations[59].parameters.properties[7].value.enum[2]'\n  (TYPE_STRING), 2\\nInvalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[7].value.enum[3]' (TYPE_STRING),\n  3\\nInvalid value at 'request.tools[0].function_declarations[60].parameters.properties[5].value.enum[0]'\n  (TYPE_STRING), 0\\nInvalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[5].value.enum[1]' (TYPE_STRING),\n  1\\nInvalid value at 'request.tools[0].function_declarations[60].parameters.properties[5].value.enum[2]'\n  (TYPE_STRING), 2\\nInvalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[5].value.enum[3]' (TYPE_STRING),\n  4\\nInvalid value at 'request.tools[0].function_declarations[60].parameters.properties[9].value.enum[0]'\n  (TYPE_STRING), 0\\nInvalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[9].value.enum[1]' (TYPE_STRING),\n  1\\nInvalid value at 'request.tools[0].function_declarations[60].parameters.properties[12].value.enum[0]'\n  (TYPE_STRING), 0\\nInvalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[12].value.enum[1]' (TYPE_STRING),\n  2\\nInvalid value at 'request.tools[0].function_declarations[60].parameters.properties[12].value.enum[2]'\n  (TYPE_STRING), 4\\nInvalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[12].value.enum[3]' (TYPE_STRING),\n  8\\nInvalid value at 'request.tools[0].function_declarations[60].parameters.properties[12].value.enum[4]'\n  (TYPE_STRING), 16\\nInvalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[12].value.enum[5]' (TYPE_STRING),\n  32\\nInvalid value at 'request.tools[0].function_declarations[60].parameters.properties[12].value.enum[6]'\n  (TYPE_STRING), 64\",\n          \"reason\": \"invalid\"\n        }\n      ],\n      \"status\": \"INVALID_ARGUMENT\",\n      \"details\": [\n        {\n          \"@type\": \"type.googleapis.com/google.rpc.BadRequest\",\n          \"fieldViolations\": [\n            {\n              \"field\": \"request.tools[0].function_declarations[16].parameters.properties[5].value.enum[0]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[16].parameters.properties[5].value.enum[0]' (TYPE_STRING), 0\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[16].parameters.properties[5].value.enum[1]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[16].parameters.properties[5].value.enum[1]' (TYPE_STRING), 1\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[16].parameters.properties[5].value.enum[2]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[16].parameters.properties[5].value.enum[2]' (TYPE_STRING), 2\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[16].parameters.properties[5].value.enum[3]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[16].parameters.properties[5].value.enum[3]' (TYPE_STRING), 3\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[16].parameters.properties[5].value.enum[4]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[16].parameters.properties[5].value.enum[4]' (TYPE_STRING), 4\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[18].parameters.properties[16].value.enum[0]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[18].parameters.properties[16].value.enum[0]' (TYPE_STRING), 2\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[18].parameters.properties[16].value.enum[1]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[18].parameters.properties[16].value.enum[1]' (TYPE_STRING), 3\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[18].parameters.properties[16].value.enum[2]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[18].parameters.properties[16].value.enum[2]' (TYPE_STRING), 4\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[18].parameters.properties[16].value.enum[3]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[18].parameters.properties[16].value.enum[3]' (TYPE_STRING), 5\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[18].parameters.properties[16].value.enum[4]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[18].parameters.properties[16].value.enum[4]' (TYPE_STRING), 6\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[18].parameters.properties[16].value.enum[5]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[18].parameters.properties[16].value.enum[5]' (TYPE_STRING), 7\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[24].parameters.properties[3].value.enum[0]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[24].parameters.properties[3].value.enum[0]' (TYPE_STRING), 0\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[24].parameters.properties[3].value.enum[1]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[24].parameters.properties[3].value.enum[1]' (TYPE_STRING), 1\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[24].parameters.properties[3].value.enum[2]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[24].parameters.properties[3].value.enum[2]' (TYPE_STRING), 2\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[59].parameters.properties[2].value.enum[0]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[2].value.enum[0]' (TYPE_STRING), 0\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[59].parameters.properties[2].value.enum[1]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[2].value.enum[1]' (TYPE_STRING), 2\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[59].parameters.properties[2].value.enum[2]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[2].value.enum[2]' (TYPE_STRING), 4\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[59].parameters.properties[2].value.enum[3]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[2].value.enum[3]' (TYPE_STRING), 8\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[59].parameters.properties[2].value.enum[4]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[2].value.enum[4]' (TYPE_STRING), 16\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[59].parameters.properties[2].value.enum[5]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[2].value.enum[5]' (TYPE_STRING), 32\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[59].parameters.properties[2].value.enum[6]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[2].value.enum[6]' (TYPE_STRING), 64\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[59].parameters.properties[7].value.enum[0]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[7].value.enum[0]' (TYPE_STRING), 0\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[59].parameters.properties[7].value.enum[1]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[7].value.enum[1]' (TYPE_STRING), 1\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[59].parameters.properties[7].value.enum[2]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[7].value.enum[2]' (TYPE_STRING), 2\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[59].parameters.properties[7].value.enum[3]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[59].parameters.properties[7].value.enum[3]' (TYPE_STRING), 3\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[60].parameters.properties[5].value.enum[0]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[5].value.enum[0]' (TYPE_STRING), 0\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[60].parameters.properties[5].value.enum[1]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[5].value.enum[1]' (TYPE_STRING), 1\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[60].parameters.properties[5].value.enum[2]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[5].value.enum[2]' (TYPE_STRING), 2\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[60].parameters.properties[5].value.enum[3]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[5].value.enum[3]' (TYPE_STRING), 4\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[60].parameters.properties[9].value.enum[0]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[9].value.enum[0]' (TYPE_STRING), 0\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[60].parameters.properties[9].value.enum[1]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[9].value.enum[1]' (TYPE_STRING), 1\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[60].parameters.properties[12].value.enum[0]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[12].value.enum[0]' (TYPE_STRING), 0\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[60].parameters.properties[12].value.enum[1]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[12].value.enum[1]' (TYPE_STRING), 2\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[60].parameters.properties[12].value.enum[2]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[12].value.enum[2]' (TYPE_STRING), 4\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[60].parameters.properties[12].value.enum[3]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[12].value.enum[3]' (TYPE_STRING), 8\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[60].parameters.properties[12].value.enum[4]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[12].value.enum[4]' (TYPE_STRING), 16\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[60].parameters.properties[12].value.enum[5]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[12].value.enum[5]' (TYPE_STRING), 32\"\n            },\n            {\n              \"field\": \"request.tools[0].function_declarations[60].parameters.properties[12].value.enum[6]\",\n              \"description\": \"Invalid value at\n  'request.tools[0].function_declarations[60].parameters.properties[12].value.enum[6]' (TYPE_STRING), 64\"\n            }\n          ]\n        }\n      ]\n    }\n  }\n  ]]\n\n----------\n/.gemini/settings.json\n\n{\n  \"mcpServers\": {\n    \"ado\": {\n      \"type\": \"stdio\",\n      \"command\": \"npx\",\n      \"args\": [\"-y\", \"@azure-devops/mcp\", \"MyOrg\"]\n    }\n  }\n}\n\n\n\n\n\n### What did you expect to happen?\n\nI expected the MCP Server to retrieve the information for my organization.\n\n### Client information\n\n\n*   **CLI Version:** 0.1.12\n*   **Git Commit:** b29c02dd (local modifications)\n*   **Operating System:** win32 v22.16.0\n*   **Sandbox Environment:** no sandbox\n*   **Model Version:** gemini-2.5-pro\n*   **Memory Usage:** 152.8 MB\n\n\n### Login information\n\n_No response_\n\n### Anything else we need to know?\n\n_No response_","comments":{"totalCount":2,"nodes":[{"body":"@maximilianosilva if you specifically install v0.1.10 it does work. But it seems to have broken for any versions both before and after that. I'm getting the same issue on the latest version (0.1.12 as of writing).","author":{"login":"brandon-schmalz"}},{"body":"Current MCP Servers are all coded according to the set standards, but Gemini uses a very strict chain transmission method, so it will report errors and cannot be used. I think the problem is that Gemini does not update to the latest method. Its creator is extremely conservative in his views. It's really trash.The only way to fix this is to pull the projects back and edit them yourself, edit the enums to the strings that gemini accepts, or replace the method completely","author":{"login":"smarthomeblack"}}]}}}],"pageInfo":{"endCursor":"Y3Vyc29yOjI2","hasNextPage":false}}}}]